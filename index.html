<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Calculate UnUn transformer insertion loss from NanoVNA S21 measurement with L-pad resistive divider. Separates mismatch and dissipative losses.">
<meta name="author" content="SA0KAM">
<meta property="og:title" content="UnUn Loss Calculator â€” NanoVNA + L-pad">
<meta property="og:description" content="Calculate UnUn transformer insertion loss from NanoVNA S21 measurement with L-pad resistive divider. Separates mismatch and dissipative losses.">
<meta property="og:url" content="https://mashu.github.io/UnunCalc/">
<meta property="og:type" content="website">
<link rel="canonical" href="https://mashu.github.io/UnunCalc/">
<title>UnUn Loss Calculator â€” NanoVNA + L-pad</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #0c1017;
    --surface: #141b24;
    --surface2: #1c2533;
    --surface3: #243040;
    --border: #2a3648;
    --text: #cdd6e0;
    --text-dim: #6b7a8d;
    --accent: #4ecdc4;
    --accent-dim: #2a7a74;
    --red: #ff6b6b;
    --yellow: #ffe66d;
    --blue: #5b9bd5;
    --purple: #a78bfa;
    --green: #6bcf7f;
    --orange: #f0a050;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    padding: 1.5rem;
  }

  .container { max-width: 720px; margin: 0 auto; }

  header {
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  h1 { font-size: 1.5rem; font-weight: 700; color: #fff; letter-spacing: -0.03em; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--text-dim); font-size: 0.88rem; margin-top: 0.3rem; }

  .lang-toggle {
    display: flex; align-items: center; gap: 0.4rem;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; padding: 0.3rem; flex-shrink: 0; margin-top: 0.2rem;
  }
  .lang-btn {
    background: transparent; border: none; color: var(--text-dim);
    font-family: 'DM Sans', sans-serif; font-size: 0.78rem; font-weight: 600;
    padding: 0.3rem 0.6rem; border-radius: 5px; cursor: pointer; transition: all 0.25s;
  }
  .lang-btn.active { background: var(--accent-dim); color: var(--accent); }
  .lang-btn:hover:not(.active) { color: var(--text); }

  .diagram-section {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.25rem; margin-bottom: 1.5rem;
  }
  .diagram-section h2 {
    font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--text-dim); margin-bottom: 1rem;
  }
  #svg-r2-group { transition: opacity 0.4s ease; }
  #svg-r2-group.hidden { opacity: 0.12; }

  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;
  }
  .card-title {
    font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--text-dim); margin-bottom: 1rem;
    display: flex; align-items: center; gap: 0.5rem;
  }
  .card-title .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }

  .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .input-group { display: flex; flex-direction: column; gap: 0.35rem; }
  .input-group.full { grid-column: 1 / -1; }
  .input-group label { font-size: 0.82rem; color: var(--text-dim); font-weight: 500; }

  .input-row {
    display: flex; align-items: stretch; border: 1px solid var(--border);
    border-radius: 8px; overflow: hidden; background: var(--surface2);
    transition: border-color 0.2s, opacity 0.3s;
  }
  .input-row:focus-within { border-color: var(--accent); }
  .input-row.disabled { opacity: 0.3; pointer-events: none; }
  .input-row input {
    flex: 1; background: transparent; border: none; color: #fff;
    font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 600;
    padding: 0.65rem 0.75rem; outline: none; min-width: 0;
  }
  .input-row input::placeholder { color: var(--text-dim); font-weight: 400; }
  .input-row .unit {
    display: flex; align-items: center; padding: 0 0.75rem;
    font-family: 'JetBrains Mono', monospace; font-size: 0.82rem;
    color: var(--text-dim); background: var(--surface3);
    border-left: 1px solid var(--border); white-space: nowrap;
  }

  /* Toggle rows */
  .toggle-row {
    display: flex; align-items: center; justify-content: space-between;
    margin-top: 1rem; padding: 0.7rem 0.9rem;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; gap: 0.75rem;
  }
  .toggle-row-text { font-size: 0.82rem; color: var(--text-dim); line-height: 1.4; }
  .toggle-row-text strong { color: var(--text); font-weight: 600; }
  .toggle-switch { position: relative; width: 44px; height: 24px; flex-shrink: 0; }
  .toggle-switch input { opacity: 0; width: 0; height: 0; }
  .toggle-slider {
    position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
    background: var(--surface3); border: 1px solid var(--border);
    border-radius: 24px; transition: all 0.3s;
  }
  .toggle-slider::before {
    content: ''; position: absolute; height: 18px; width: 18px;
    left: 2px; bottom: 2px; background: var(--text-dim);
    border-radius: 50%; transition: all 0.3s cubic-bezier(0.34, 1.4, 0.64, 1);
  }
  .toggle-switch input:checked + .toggle-slider {
    background: var(--accent-dim); border-color: var(--accent);
  }
  .toggle-switch input:checked + .toggle-slider::before {
    transform: translateX(20px); background: var(--accent);
  }

  /* Gauge */
  .gauge-container { padding: 1.5rem 0 1rem; }
  .gauge-label-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.5rem; }
  .gauge-title { font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-dim); }
  .gauge-value {
    font-family: 'JetBrains Mono', monospace; font-size: 1.8rem;
    font-weight: 700; transition: color 0.5s ease;
  }
  .gauge-value .unit-sm { font-size: 0.9rem; font-weight: 400; color: var(--text-dim); }
  .gauge-track {
    position: relative; height: 14px; border-radius: 7px;
    background: var(--surface3); overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
  }
  .gauge-fill {
    position: absolute; left: 0; top: 0; bottom: 0; border-radius: 7px;
    transition: width 0.6s cubic-bezier(0.34, 1.4, 0.64, 1), background-color 0.5s ease;
    min-width: 4px;
  }
  .gauge-glow {
    position: absolute; right: -2px; top: -3px; bottom: -3px;
    width: 8px; border-radius: 50%; filter: blur(4px);
    transition: background-color 0.5s ease; pointer-events: none;
  }
  .gauge-ticks {
    display: flex; justify-content: space-between; margin-top: 0.35rem; padding: 0 2px;
  }
  .gauge-ticks span { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-dim); }
  .gauge-zones { display: flex; gap: 0.5rem; margin-top: 0.7rem; flex-wrap: wrap; }
  .zone-tag {
    font-size: 0.72rem; padding: 0.2rem 0.6rem; border-radius: 4px; font-weight: 600;
    transition: opacity 0.4s, transform 0.4s cubic-bezier(0.34, 1.4, 0.64, 1);
  }
  .zone-tag.active { transform: scale(1.1); opacity: 1; }
  .zone-tag.inactive { opacity: 0.25; transform: scale(1); }
  .zt-excellent { background: #122b12; color: var(--green); border: 1px solid #1a3d1a; }
  .zt-good { background: #2a2a10; color: var(--yellow); border: 1px solid #3d3d1a; }
  .zt-poor { background: #2a1515; color: var(--red); border: 1px solid #3d1a1a; }

  /* Loss breakdown bar */
  .loss-breakdown { margin-top: 1.2rem; }
  .loss-breakdown-title {
    font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.08em;
    color: var(--text-dim); margin-bottom: 0.6rem;
  }
  .loss-bar-container {
    display: flex; height: 28px; border-radius: 6px; overflow: hidden;
    background: var(--surface3); margin-bottom: 0.5rem;
  }
  .loss-bar-segment {
    display: flex; align-items: center; justify-content: center;
    font-family: 'JetBrains Mono', monospace; font-size: 0.72rem; font-weight: 600;
    color: var(--bg); transition: width 0.6s cubic-bezier(0.34, 1.4, 0.64, 1);
    min-width: 0; overflow: hidden; white-space: nowrap;
  }
  .loss-bar-mismatch { background: var(--orange); }
  .loss-bar-dissipative { background: var(--red); }

  .loss-legend {
    display: flex; gap: 1.2rem; flex-wrap: wrap;
  }
  .loss-legend-item {
    display: flex; align-items: center; gap: 0.4rem;
    font-size: 0.8rem; color: var(--text-dim);
  }
  .loss-legend-dot {
    width: 10px; height: 10px; border-radius: 3px; flex-shrink: 0;
  }
  .loss-legend-val {
    font-family: 'JetBrains Mono', monospace; font-weight: 600;
    font-size: 0.82rem;
  }

  /* Results */
  .results {
    background: var(--surface); border: 1px solid var(--accent-dim);
    border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem;
  }
  .result-row {
    display: flex; justify-content: space-between; align-items: baseline;
    padding: 0.6rem 0; border-bottom: 1px solid var(--border);
  }
  .result-row:last-child { border-bottom: none; }
  .result-row.hidden { display: none; }
  .result-label { font-size: 0.88rem; color: var(--text-dim); }
  .result-value {
    font-family: 'JetBrains Mono', monospace; font-size: 1.05rem;
    font-weight: 700; color: #fff; transition: color 0.3s;
  }
  .result-value.accent { color: var(--accent); }
  .result-value.blue { color: var(--blue); }

  .formula-display {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 8px; padding: 0.75rem 1rem; margin-top: 0.75rem;
    font-family: 'JetBrains Mono', monospace; font-size: 0.82rem;
    color: var(--text-dim); line-height: 1.7;
  }
  .formula-display .hl { color: var(--accent); font-weight: 600; }
  .formula-display .hl2 { color: var(--red); font-weight: 600; }
  .formula-display .hl3 { color: var(--yellow); font-weight: 600; }
  .formula-display .hl4 { color: var(--orange); font-weight: 600; }

  /* Info sections */
  .info-section {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem;
  }
  .info-section summary {
    cursor: pointer; font-size: 0.88rem; font-weight: 600; color: var(--accent);
    list-style: none; display: flex; align-items: center; gap: 0.5rem; user-select: none;
  }
  .info-section summary::-webkit-details-marker { display: none; }
  .info-section summary::before {
    content: 'â–¸'; font-size: 0.8rem; transition: transform 0.2s; display: inline-block;
  }
  .info-section[open] summary::before { transform: rotate(90deg); }
  .info-content { margin-top: 1rem; font-size: 0.88rem; color: var(--text-dim); line-height: 1.65; }
  .info-content p { margin-bottom: 0.7rem; }
  .info-content strong { color: var(--text); font-weight: 600; }
  .info-content code {
    font-family: 'JetBrains Mono', monospace; background: var(--surface3);
    padding: 0.1rem 0.35rem; border-radius: 3px; font-size: 0.82rem; color: var(--accent);
  }
  .note {
    background: #1a2030; border-left: 3px solid var(--blue);
    padding: 0.75rem 1rem; margin-top: 0.8rem; border-radius: 0 8px 8px 0;
    font-size: 0.82rem; color: var(--text-dim); line-height: 1.5;
  }
  .note.warn { border-left-color: var(--yellow); background: #1f1d14; }
  .note.info-orange { border-left-color: var(--orange); background: #1f1a14; }

  footer {
    text-align: center; margin-top: 2.5rem; padding: 1rem;
    color: var(--text-dim); font-size: 0.75rem;
  }
  footer a { color: var(--accent); text-decoration: none; }
  footer a:hover { text-decoration: underline; }

  @media (max-width: 500px) {
    .input-grid { grid-template-columns: 1fr; }
    body { padding: 1rem; }
    header { flex-direction: column; gap: 0.8rem; }
    .loss-legend { flex-direction: column; gap: 0.4rem; }
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <div>
      <h1 data-i18n="title">UnUn Loss <span>Calculator</span></h1>
      <p class="subtitle" data-i18n="subtitle">S21 measurement with L-pad divider on NanoVNA</p>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="btn-pl" onclick="setLang('pl')">PL</button>
    </div>
  </header>

  <!-- â•â•â• DIAGRAM â•â•â• -->
  <div class="diagram-section">
    <h2 data-i18n="diagram_title">Connection diagram</h2>
    <svg viewBox="0 0 680 180" width="100%" style="display:block;">
      <defs>
        <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="#ffe66d"/>
        </marker>
      </defs>
      <rect x="5" y="45" width="90" height="70" rx="6" fill="#1e3a5f" stroke="#5b9bd5" stroke-width="1.5"/>
      <text x="50" y="72" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700">VNA P1</text>
      <text x="50" y="90" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="9" opacity="0.7">50 Î©</text>
      <line x1="95" y1="75" x2="160" y2="75" stroke="#5b9bd5" stroke-width="2"/>
      <rect x="160" y="40" width="110" height="80" rx="6" fill="#3a1e1e" stroke="#ff6b6b" stroke-width="1.5"/>
      <text x="215" y="68" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700">UnUn</text>
      <text x="215" y="85" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono, monospace" font-size="9" opacity="0.7">1 : k</text>
      <text x="215" y="108" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono, monospace" font-size="8" opacity="0.5" data-i18n-svg="svg_dut">â† DUT</text>
      <line x1="270" y1="75" x2="320" y2="75" stroke="#ff6b6b" stroke-width="2"/>
      <rect x="320" y="62" width="80" height="26" rx="4" fill="none" stroke="#4ecdc4" stroke-width="1.5"/>
      <text x="360" y="80" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="10" font-weight="600">Râ‚</text>
      <text x="360" y="55" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="8" data-i18n-svg="svg_series">series</text>
      <line x1="400" y1="75" x2="460" y2="75" stroke="#4ecdc4" stroke-width="2"/>
      <circle cx="460" cy="75" r="3" fill="#4ecdc4" id="svg-junction"/>
      <g id="svg-r2-group">
        <line x1="460" y1="78" x2="460" y2="98" stroke="#4ecdc4" stroke-width="1.5"/>
        <rect x="448" y="98" width="24" height="42" rx="4" fill="none" stroke="#4ecdc4" stroke-width="1.5"/>
        <text x="460" y="123" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="9" font-weight="600">Râ‚‚</text>
        <text x="485" y="125" text-anchor="start" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="8" data-i18n-svg="svg_shunt">shunt</text>
        <line x1="460" y1="140" x2="460" y2="160" stroke="#6b8e5a" stroke-width="1.5" stroke-dasharray="4,2"/>
      </g>
      <line x1="460" y1="75" x2="575" y2="75" stroke="#5b9bd5" stroke-width="2"/>
      <rect x="575" y="45" width="90" height="70" rx="6" fill="#1e3a5f" stroke="#5b9bd5" stroke-width="1.5"/>
      <text x="620" y="72" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700">VNA P2</text>
      <text x="620" y="90" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="9" opacity="0.7">50 Î©</text>
      <text x="620" y="105" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="7" opacity="0" id="svg-builtin-label" data-i18n-svg="svg_builtin">built-in 50Î© load</text>
      <line x1="50" y1="115" x2="50" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="215" y1="120" x2="215" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="30" y1="160" x2="650" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="620" y1="115" x2="620" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="340" y="175" text-anchor="middle" fill="#6b8e5a" font-family="JetBrains Mono, monospace" font-size="9">GND</text>
      <line x1="130" y1="30" x2="530" y2="30" stroke="#ffe66d" stroke-width="1" marker-end="url(#arr)" opacity="0.5"/>
      <text x="330" y="25" text-anchor="middle" fill="#ffe66d" font-family="JetBrains Mono, monospace" font-size="8" opacity="0.6" data-i18n-svg="svg_signal">S21 signal â†’</text>
    </svg>
  </div>

  <!-- â•â•â• L-PAD â•â•â• -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--accent)"></span> <span data-i18n="lpad_title">L-pad divider parameters</span></div>
    <div class="input-grid">
      <div class="input-group">
        <label data-i18n="r1_label">Râ‚ (series)</label>
        <div class="input-row">
          <input type="number" id="r1" value="1206.9" step="0.1" oninput="calculate()">
          <span class="unit">Î©</span>
        </div>
      </div>
      <div class="input-group">
        <label data-i18n="r2_label">Râ‚‚ (shunt)</label>
        <div class="input-row" id="r2-input-row">
          <input type="number" id="r2" value="50.034" step="0.001" oninput="calculate()">
          <span class="unit">Î©</span>
        </div>
      </div>
    </div>
    <div class="toggle-row">
      <div class="toggle-row-text">
        <strong data-i18n="r2_toggle_title">External Râ‚‚ shunt resistor</strong><br>
        <span data-i18n="r2_toggle_desc">Disable if using only VNA Port 2 built-in 50 Î© termination</span>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="r2-toggle" checked onchange="toggleR2()">
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <!-- â•â•â• UNUN â•â•â• -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--red)"></span> <span data-i18n="unun_title">UnUn parameters</span></div>
    <div class="input-grid">
      <div class="input-group">
        <label data-i18n="ratio_label">Impedance ratio (k)</label>
        <div class="input-row">
          <input type="number" id="ratio" value="25" step="1" oninput="calculate()">
          <span class="unit">: 1</span>
        </div>
      </div>
      <div class="input-group">
        <label data-i18n="z0_label">Zâ‚€ (VNA impedance)</label>
        <div class="input-row">
          <input type="number" id="z0" value="50" step="1" oninput="calculate()">
          <span class="unit">Î©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• VNA READINGS â•â•â• -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--yellow)"></span> <span data-i18n="vna_title">NanoVNA readings</span></div>
    <div class="input-grid">
      <div class="input-group">
        <label data-i18n="s21_label">S21 (LogMag, from marker)</label>
        <div class="input-row">
          <input type="number" id="s21measured" value="-20.5" step="0.1" oninput="calculate()">
          <span class="unit">dB</span>
        </div>
      </div>
      <div class="input-group">
        <label data-i18n="freq_label">Frequency (informational)</label>
        <div class="input-row">
          <input type="number" id="freq" value="7.1" step="0.1" placeholder="e.g. 7.1">
          <span class="unit">MHz</span>
        </div>
      </div>
    </div>
    <div class="note" style="margin-top:0.8rem" data-i18n-html="vna_note">
      ğŸ’¡ Measure S21 separately at each band frequency. UnUn losses increase with frequency â€” check at 3.5, 7, 14, 21 and 28&nbsp;MHz.
    </div>

    <!-- S11 toggle + input -->
    <div class="toggle-row" style="margin-top:1rem">
      <div class="toggle-row-text">
        <strong data-i18n="s11_toggle_title">S11 return loss (mismatch analysis)</strong><br>
        <span data-i18n="s11_toggle_desc">Enable to separate mismatch loss from dissipative (heat) loss</span>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="s11-toggle" onchange="toggleS11()">
        <span class="toggle-slider"></span>
      </label>
    </div>

    <div id="s11-section" style="display:none; margin-top:1rem;">
      <div class="input-grid">
        <div class="input-group">
          <label data-i18n="s11_label">S11 (LogMag, from marker)</label>
          <div class="input-row">
            <input type="number" id="s11measured" value="-10" step="0.1" oninput="calculate()">
            <span class="unit">dB</span>
          </div>
        </div>
        <div class="input-group">
          <label data-i18n="s11_swr_label">SWR (calculated)</label>
          <div class="input-row disabled" style="pointer-events:none">
            <input type="text" id="s11-swr" value="â€”" readonly style="font-weight:500;color:var(--orange)">
            <span class="unit">: 1</span>
          </div>
        </div>
      </div>
      <div class="note info-orange" style="margin-top:0.8rem" data-i18n-html="s11_note">
        ğŸ’¡ Read S11 from <strong>the same marker frequency</strong> as S21. On NanoVNA: S11 is CH0 (TRACE 0), displayed by default. Use the same marker position â€” just switch between CH0 and CH1 to read both values.
      </div>
    </div>
  </div>

  <!-- â•â•â• RESULTS + GAUGE â•â•â• -->
  <div class="results">
    <div class="card-title"><span class="dot" style="background:var(--green)"></span> <span data-i18n="results_title">Results</span></div>

    <!-- Total loss gauge -->
    <div class="gauge-container">
      <div class="gauge-label-row">
        <span class="gauge-title" data-i18n="gauge_title">Total insertion loss</span>
        <span class="gauge-value" id="gauge-val">â€” <span class="unit-sm">dB</span></span>
      </div>
      <div class="gauge-track">
        <div class="gauge-fill" id="gauge-fill" style="width:0%; background:var(--green);">
          <div class="gauge-glow" id="gauge-glow"></div>
        </div>
      </div>
      <div class="gauge-ticks">
        <span>0</span><span>0.25</span><span>0.5</span><span>1.0</span><span>1.5</span><span>2.0</span><span>3.0+ dB</span>
      </div>
      <div class="gauge-zones">
        <span class="zone-tag zt-excellent inactive" id="zt-exc" data-i18n="zone_exc">â—‰ Excellent &lt; 0.5 dB</span>
        <span class="zone-tag zt-good inactive" id="zt-good" data-i18n="zone_good">â—‰ OK 0.5â€“1.0 dB</span>
        <span class="zone-tag zt-poor inactive" id="zt-poor" data-i18n="zone_poor">â—‰ Poor &gt; 1.0 dB</span>
      </div>
    </div>

    <!-- Loss breakdown (visible when S11 enabled) -->
    <div class="loss-breakdown" id="loss-breakdown" style="display:none">
      <div class="loss-breakdown-title" data-i18n="breakdown_title">Loss breakdown</div>
      <div class="loss-bar-container">
        <div class="loss-bar-segment loss-bar-mismatch" id="bar-mismatch" style="width:0%"></div>
        <div class="loss-bar-segment loss-bar-dissipative" id="bar-dissipative" style="width:0%"></div>
      </div>
      <div class="loss-legend">
        <div class="loss-legend-item">
          <span class="loss-legend-dot" style="background:var(--orange)"></span>
          <span data-i18n="legend_mismatch">Mismatch (reflected)</span>
          <span class="loss-legend-val" id="legend-mismatch-val" style="color:var(--orange)">â€”</span>
        </div>
        <div class="loss-legend-item">
          <span class="loss-legend-dot" style="background:var(--red)"></span>
          <span data-i18n="legend_dissipative">Dissipative (heat)</span>
          <span class="loss-legend-val" id="legend-dissipative-val" style="color:var(--red)">â€”</span>
        </div>
      </div>
    </div>

    <!-- Result rows -->
    <div style="margin-top:0.5rem">
      <div class="result-row">
        <span class="result-label" data-i18n="res_zunun">UnUn output Z (k Ã— Zâ‚€)</span>
        <span class="result-value blue" id="out-zunun">â€”</span>
      </div>
      <div class="result-row">
        <span class="result-label" data-i18n="res_zin" id="lbl-zin">Divider input Z (Râ‚ + Râ‚‚â€–Zâ‚€)</span>
        <span class="result-value accent" id="out-zin">â€”</span>
      </div>
      <div class="result-row">
        <span class="result-label" data-i18n="res_zref">Reflected Z to primary side</span>
        <span class="result-value" id="out-zreflected">â€”</span>
      </div>
      <div class="result-row">
        <span class="result-label" data-i18n="res_divloss" id="lbl-divloss">Divider attenuation (theoretical)</span>
        <span class="result-value" id="out-divloss" style="color:var(--yellow)">â€”</span>
      </div>
      <div class="result-row">
        <span class="result-label" data-i18n="res_s21">Measured S21 (full path)</span>
        <span class="result-value" id="out-s21meas">â€”</span>
      </div>
      <!-- S11 result rows -->
      <div class="result-row hidden" id="row-s11">
        <span class="result-label" data-i18n="res_s11">Measured S11 (return loss)</span>
        <span class="result-value" id="out-s11" style="color:var(--orange)">â€”</span>
      </div>
      <div class="result-row hidden" id="row-mismatch">
        <span class="result-label" data-i18n="res_mismatch">Mismatch loss (from SWR)</span>
        <span class="result-value" id="out-mismatch" style="color:var(--orange)">â€”</span>
      </div>
      <div class="result-row hidden" id="row-dissipative">
        <span class="result-label" data-i18n="res_dissipative">Dissipative loss (heat in core/wire)</span>
        <span class="result-value" id="out-dissipative" style="color:var(--red)">â€”</span>
      </div>
    </div>

    <div class="formula-display" id="formula-block">
      <span class="hl">Râ‚‚â€–Zâ‚€</span> = Râ‚‚Â·Zâ‚€ / (Râ‚‚+Zâ‚€)<br>
      <span class="hl3">S21_div</span> = 10Â·logâ‚â‚€( 4Â·Z_sÂ·(Râ‚‚â€–Zâ‚€)Â² / ((Z_s+Râ‚+Râ‚‚â€–Zâ‚€)Â²Â·Zâ‚€) )<br>
      <span class="hl2">UnUn Loss</span> = <span class="hl3">S21_div</span> âˆ’ S21_measured
    </div>
  </div>

  <!-- â•â•â• INFO: S11 EXPLAINED â•â•â• -->
  <details class="info-section" id="info-s11-section" style="display:none">
    <summary>ğŸ“Š <span data-i18n="info_s11_title">What is S11 and how does mismatch analysis work?</span></summary>
    <div class="info-content" data-i18n-html="info_s11_body">
      <p><strong>S21 measures total insertion loss</strong> â€” but it doesn't tell you <em>why</em> you're losing power. There are two fundamentally different loss mechanisms:</p>
      <p><strong>Mismatch loss (reflected power)</strong> â€” when the transformer doesn't present a perfect 50 Î© to Port 1, some power reflects back to the source. This power isn't lost as heat â€” it simply bounces back. On a real transmitter, this reflected power gets re-reflected and mostly ends up radiated anyway (on coax-fed systems), so mismatch loss is often less harmful than it appears.</p>
      <p><strong>Dissipative loss (heat)</strong> â€” power genuinely absorbed by the ferrite core (hysteresis + eddy currents) and winding resistance. This is the "real" loss â€” energy converted to heat that never reaches the antenna. This is what degrades your signal and can overheat the transformer at higher power.</p>
      <p><strong>S11 (return loss)</strong> tells you how much power reflects back from Port 1. From S11 you can calculate the reflection coefficient Î“ and the mismatch loss:</p>
      <p><code>|Î“| = 10^(S11_dB / 20)</code><br>
      <code>Mismatch loss = âˆ’10Â·logâ‚â‚€(1 âˆ’ |Î“|Â²)</code> dB<br>
      <code>SWR = (1 + |Î“|) / (1 âˆ’ |Î“|)</code></p>
      <p><strong>Dissipative loss = Total loss âˆ’ Mismatch loss</strong></p>
      <p>This is the number you should really care about. A transformer with 2 dB total loss but 1.5 dB of that being mismatch is actually much better than one with 2 dB total loss and only 0.2 dB mismatch â€” because the second one is burning 1.8 dB as heat.</p>
      <div class="note info-orange">
        âš  <strong>Important:</strong> This separation is approximate. In a real transformer, mismatch and dissipation interact â€” reflected waves pass through lossy material multiple times. But for practical evaluation of homebrew UnUns, this approximation is very useful.
      </div>
    </div>
  </details>

  <!-- â•â•â• INFO: HOW TO MEASURE S11 â•â•â• -->
  <details class="info-section" id="info-s11-howto" style="display:none">
    <summary>ğŸ”§ <span data-i18n="info_s11_howto_title">How to measure S11 on NanoVNA</span></summary>
    <div class="info-content" data-i18n-html="info_s11_howto_body">
      <p><strong>Good news: NanoVNA measures S11 and S21 simultaneously.</strong> You don't need a separate measurement â€” both are available from the same sweep.</p>
      <p><strong>1.</strong> With your setup connected (P1 â†’ UnUn â†’ divider â†’ P2), the VNA is already measuring both S11 and S21.</p>
      <p><strong>2.</strong> S11 is on <code>CH0 / TRACE 0</code> â€” this is usually displayed by default. Make sure format is <code>LOGMAG</code>.</p>
      <p><strong>3.</strong> S21 is on <code>CH1 / TRACE 1</code>.</p>
      <p><strong>4.</strong> Place a marker at your frequency of interest (e.g. 7.1 MHz).</p>
      <p><strong>5.</strong> The marker readout shows values for all active traces. Read <strong>S11 from CH0</strong> and <strong>S21 from CH1</strong> at the same marker position.</p>
      <p><strong>6.</strong> If you only see one trace, enable both: <code>DISPLAY â†’ TRACE â†’ TRACE 0</code> (S11) and <code>TRACE 1</code> (S21). Both should be in LOGMAG format.</p>
      <p><strong>What to expect:</strong></p>
      <p>â€¢ <strong>S11 = âˆ’6 dB</strong> â†’ SWR 3:1, mismatch loss 1.25 dB (significant reflection)<br>
      â€¢ <strong>S11 = âˆ’10 dB</strong> â†’ SWR 1.9:1, mismatch loss 0.46 dB (moderate)<br>
      â€¢ <strong>S11 = âˆ’14 dB</strong> â†’ SWR 1.5:1, mismatch loss 0.18 dB (good)<br>
      â€¢ <strong>S11 = âˆ’20 dB</strong> â†’ SWR 1.2:1, mismatch loss 0.04 dB (excellent)</p>
      <div class="note">
        ğŸ’¡ If S11 is worse than âˆ’6 dB (SWR > 3:1), your divider impedance may not be well matched to the UnUn output. Double-check the wiring and resistor values.
      </div>
    </div>
  </details>

  <!-- â•â•â• INFO: FREQUENCY â•â•â• -->
  <details class="info-section" open>
    <summary>ğŸ“¡ <span data-i18n="info_freq_title">Does frequency matter?</span></summary>
    <div class="info-content" data-i18n-html="info_freq_body">
      <p><strong>Yes, significantly.</strong> UnUn losses change with frequency â€” they typically increase toward higher bands. A single measurement is not enough. You should measure S21 at multiple frequencies (using markers) and compare losses separately for each band.</p>
      <p><strong>Typical behavior:</strong> at 3.5 MHz losses may be 0.2 dB, at 14 MHz â€” 0.5 dB, and at 28 MHz â€” 1+ dB. This depends on core material (mix 43, 31, 61 etc.), number of turns, and construction.</p>
      <p><strong>The resistive divider</strong> itself is broadband and essentially frequency-independent â€” provided you use <strong>non-inductive</strong> resistors (metal film, SMD, or composition).</p>
      <div class="note warn">âš  <strong>Do not use wire-wound resistors!</strong> Their parasitic inductance will corrupt measurements above ~10 MHz. Metal film or SMD resistors are fine.</div>
    </div>
  </details>

  <!-- â•â•â• INFO: CALIBRATION â•â•â• -->
  <details class="info-section">
    <summary>ğŸ”§ <span data-i18n="info_cal_title">How to calibrate the NanoVNA?</span></summary>
    <div class="info-content" data-i18n-html="info_cal_body">
      <p><strong>Full 2-port calibration (SOLT + THRU)</strong> â€” essential for accurate S21:</p>
      <p><strong>1.</strong> Set frequency range: <code>STIMULUS â†’ START 1 MHz</code>, <code>STOP 30 MHz</code></p>
      <p><strong>2.</strong> Connect cables to both ports â€” the same cables you'll use for the measurement</p>
      <p><strong>3.</strong> Calibrate at cable ends:</p>
      <p>â€¢ Port CH0: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Port CH1: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Both ports: <code>THRU</code> (connect P1 to P2)</p>
      <p><strong>4.</strong> Save: <code>CAL â†’ SAVE â†’ SAVE 0</code></p>
      <p><strong>5. Verify:</strong> connect THRU and check that S21 reads ~0 dB. Â±0.1 dB is OK.</p>
      <div class="note">ğŸ’¡ Calibration is valid for a specific set of cables and frequency range. Change cables â€” recalibrate.</div>
      <div class="note warn" style="margin-top:0.5rem">âš  Calibrate <strong>without</strong> the UnUn and divider. Calibration establishes the reference plane at the cable ends.</div>
    </div>
  </details>

  <!-- â•â•â• INFO: PROCEDURE â•â•â• -->
  <details class="info-section">
    <summary>ğŸ“‹ <span data-i18n="info_proc_title">Step-by-step procedure</span></summary>
    <div class="info-content" data-i18n-html="info_proc_body">
      <p><strong>1.</strong> Calibrate NanoVNA (2-port, 1â€“30 MHz)</p>
      <p><strong>2.</strong> Enable: <code>DISPLAY â†’ TRACE â†’ CH1</code> â†’ <code>FORMAT â†’ LOGMAG</code></p>
      <p><strong>3.</strong> Connect: P1 â†’ UnUn (50 Î© input) â†’ UnUn output â†’ Râ‚ series â†’ junction â†’ P2, with Râ‚‚ from junction to GND</p>
      <p><strong>4.</strong> Set markers: <code>MARKER â†’ SELECT</code> at 3.5, 7, 14, 21, 28 MHz</p>
      <p><strong>5.</strong> Read S21 [dB] from each marker â†’ enter in this calculator</p>
      <p><strong>6.</strong> Calculator subtracts divider attenuation = pure UnUn loss</p>
      <p><strong>7.</strong> Optionally: enable S11 analysis, read S11 from CH0 at the same marker â†’ enter to separate mismatch from heat loss</p>
      <div class="note">ğŸ’¡ <strong>Divider verification:</strong> connect the divider alone (no UnUn) P1 â†’ Râ‚ â†’ Râ‚‚ â†’ P2. S21 should match the "Divider attenuation" value from the calculator (Â±0.2 dB).</div>
    </div>
  </details>

  <footer>SA0KAM Â· <a href="https://github.com/mashu/UnunCalc">GitHub</a></footer>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// i18n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const i18n = {
  en: {
    title: 'UnUn Loss <span>Calculator</span>',
    subtitle: 'S21 measurement with L-pad divider on NanoVNA',
    diagram_title: 'Connection diagram',
    lpad_title: 'L-pad divider parameters',
    r1_label: 'Râ‚ (series)', r2_label: 'Râ‚‚ (shunt)',
    unun_title: 'UnUn parameters',
    ratio_label: 'Impedance ratio (k)', z0_label: 'Zâ‚€ (VNA impedance)',
    vna_title: 'NanoVNA readings',
    s21_label: 'S21 (LogMag, from marker)',
    freq_label: 'Frequency (informational)',
    vna_note: 'ğŸ’¡ Measure S21 separately at each band frequency. UnUn losses increase with frequency â€” check at 3.5, 7, 14, 21 and 28\u00A0MHz.',
    s11_toggle_title: 'S11 return loss (mismatch analysis)',
    s11_toggle_desc: 'Enable to separate mismatch loss from dissipative (heat) loss',
    s11_label: 'S11 (LogMag, from marker)',
    s11_swr_label: 'SWR (calculated)',
    s11_note: 'ğŸ’¡ Read S11 from <strong>the same marker frequency</strong> as S21. On NanoVNA: S11 is CH0 (TRACE 0), displayed by default. Use the same marker position â€” just read both CH0 and CH1 values.',
    results_title: 'Results',
    gauge_title: 'Total insertion loss',
    zone_exc: 'â—‰ Excellent < 0.5 dB', zone_good: 'â—‰ OK 0.5â€“1.0 dB', zone_poor: 'â—‰ Poor > 1.0 dB',
    breakdown_title: 'Loss breakdown',
    legend_mismatch: 'Mismatch (reflected)',
    legend_dissipative: 'Dissipative (heat)',
    res_zunun: 'UnUn output Z (k Ã— Zâ‚€)',
    res_zin: 'Divider input Z (Râ‚ + Râ‚‚â€–Zâ‚€)',
    res_zin_no_r2: 'Load Z (Râ‚ + Zâ‚€)',
    res_zref: 'Reflected Z to primary side',
    res_divloss: 'Divider attenuation (theoretical)',
    res_divloss_no_r2: 'Râ‚ attenuation (theoretical)',
    res_s21: 'Measured S21 (full path)',
    res_s11: 'Measured S11 (return loss)',
    res_mismatch: 'Mismatch loss (from SWR)',
    res_dissipative: 'Dissipative loss (heat in core/wire)',
    formula_loss: 'Total Loss',
    formula_mismatch: 'Mismatch',
    formula_dissipative: 'Dissipative',
    gauge_negative: 'dB âš  negative',
    svg_dut: 'â† DUT', svg_series: 'series', svg_shunt: 'shunt',
    svg_signal: 'S21 signal â†’', svg_builtin: 'built-in 50Î© load',
    r2_toggle_title: 'External Râ‚‚ shunt resistor',
    r2_toggle_desc: 'Disable if using only VNA Port 2 built-in 50 Î© termination',
    info_freq_title: 'Does frequency matter?',
    info_freq_body: '<p><strong>Yes, significantly.</strong> UnUn losses change with frequency â€” they typically increase toward higher bands. A single measurement is not enough. You should measure S21 at multiple frequencies (using markers) and compare losses separately for each band.</p><p><strong>Typical behavior:</strong> at 3.5 MHz losses may be 0.2 dB, at 14 MHz â€” 0.5 dB, and at 28 MHz â€” 1+ dB. This depends on core material (mix 43, 31, 61 etc.), number of turns, and construction.</p><p><strong>The resistive divider</strong> itself is broadband and essentially frequency-independent â€” provided you use <strong>non-inductive</strong> resistors (metal film, SMD, or composition).</p><div class="note warn">âš  <strong>Do not use wire-wound resistors!</strong> Their parasitic inductance will corrupt measurements above ~10 MHz. Metal film or SMD resistors are fine.</div>',
    info_cal_title: 'How to calibrate the NanoVNA?',
    info_cal_body: '<p><strong>Full 2-port calibration (SOLT + THRU)</strong> â€” essential for accurate S21:</p><p><strong>1.</strong> Set frequency range: <code>STIMULUS â†’ START 1 MHz</code>, <code>STOP 30 MHz</code></p><p><strong>2.</strong> Connect cables to both ports â€” the same cables you\'ll use for the measurement</p><p><strong>3.</strong> Calibrate at cable ends:</p><p>â€¢ Port CH0: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Port CH1: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Both ports: <code>THRU</code> (connect P1 to P2)</p><p><strong>4.</strong> Save: <code>CAL â†’ SAVE â†’ SAVE 0</code></p><p><strong>5. Verify:</strong> connect THRU and check that S21 reads ~0 dB. Â±0.1 dB is OK.</p><div class="note">ğŸ’¡ Calibration is valid for a specific set of cables and frequency range. Change cables â€” recalibrate.</div><div class="note warn" style="margin-top:0.5rem">âš  Calibrate <strong>without</strong> the UnUn and divider. Calibration establishes the reference plane at the cable ends.</div>',
    info_proc_title: 'Step-by-step procedure',
    info_proc_body: '<p><strong>1.</strong> Calibrate NanoVNA (2-port, 1â€“30 MHz)</p><p><strong>2.</strong> Enable: <code>DISPLAY â†’ TRACE â†’ CH1</code> â†’ <code>FORMAT â†’ LOGMAG</code></p><p><strong>3.</strong> Connect: P1 â†’ UnUn (50 Î© input) â†’ UnUn output â†’ Râ‚ series â†’ junction â†’ P2, with Râ‚‚ from junction to GND</p><p><strong>4.</strong> Set markers: <code>MARKER â†’ SELECT</code> at 3.5, 7, 14, 21, 28 MHz</p><p><strong>5.</strong> Read S21 [dB] from each marker â†’ enter in this calculator</p><p><strong>6.</strong> Calculator subtracts divider attenuation = pure UnUn loss</p><p><strong>7.</strong> Optionally: enable S11 analysis, read S11 from CH0 at the same marker â†’ enter to separate mismatch from heat loss</p><div class="note">ğŸ’¡ <strong>Divider verification:</strong> connect the divider alone (no UnUn) P1 â†’ Râ‚ â†’ Râ‚‚ â†’ P2. S21 should match the "Divider attenuation" value from the calculator (Â±0.2 dB).</div>',
    info_s11_title: 'What is S11 and how does mismatch analysis work?',
    info_s11_body: '<p><strong>S21 measures total insertion loss</strong> â€” but it doesn\'t tell you <em>why</em> you\'re losing power. There are two fundamentally different loss mechanisms:</p><p><strong>Mismatch loss (reflected power)</strong> â€” when the transformer doesn\'t present a perfect 50 Î© to Port 1, some power reflects back to the source. This power isn\'t lost as heat â€” it simply bounces back. On a real transmitter, this reflected power gets re-reflected and mostly ends up radiated anyway (on coax-fed systems), so mismatch loss is often less harmful than it appears.</p><p><strong>Dissipative loss (heat)</strong> â€” power genuinely absorbed by the ferrite core (hysteresis + eddy currents) and winding resistance. This is the "real" loss â€” energy converted to heat that never reaches the antenna. This is what degrades your signal and can overheat the transformer at higher power.</p><p><strong>S11 (return loss)</strong> tells you how much power reflects back from Port 1. From S11 you calculate the reflection coefficient Î“ and the mismatch loss:</p><p><code>|Î“| = 10^(S11_dB / 20)</code><br><code>Mismatch loss = âˆ’10Â·logâ‚â‚€(1 âˆ’ |Î“|Â²)</code> dB<br><code>SWR = (1 + |Î“|) / (1 âˆ’ |Î“|)</code></p><p><strong>Dissipative loss = Total loss âˆ’ Mismatch loss</strong></p><p>This is the number you should really care about. A transformer with 2 dB total loss but 1.5 dB mismatch is actually much better than one with 2 dB total but only 0.2 dB mismatch â€” because the second one is burning 1.8 dB as heat.</p><div class="note info-orange">âš  <strong>Important:</strong> This separation is approximate. In a real transformer, mismatch and dissipation interact â€” reflected waves pass through lossy material multiple times. But for practical evaluation of homebrew UnUns, this approximation is very useful.</div>',
    info_s11_howto_title: 'How to measure S11 on NanoVNA',
    info_s11_howto_body: '<p><strong>Good news: NanoVNA measures S11 and S21 simultaneously.</strong> You don\'t need a separate measurement â€” both are available from the same sweep.</p><p><strong>1.</strong> With your setup connected (P1 â†’ UnUn â†’ divider â†’ P2), the VNA is already measuring both S11 and S21.</p><p><strong>2.</strong> S11 is on <code>CH0 / TRACE 0</code> â€” this is usually displayed by default. Make sure format is <code>LOGMAG</code>.</p><p><strong>3.</strong> S21 is on <code>CH1 / TRACE 1</code>.</p><p><strong>4.</strong> Place a marker at your frequency of interest (e.g. 7.1 MHz).</p><p><strong>5.</strong> The marker readout shows values for all active traces. Read <strong>S11 from CH0</strong> and <strong>S21 from CH1</strong> at the same marker position.</p><p><strong>6.</strong> If you only see one trace, enable both: <code>DISPLAY â†’ TRACE â†’ TRACE 0</code> (S11) and <code>TRACE 1</code> (S21). Both should be in LOGMAG format.</p><p><strong>What to expect:</strong></p><p>â€¢ <strong>S11 = âˆ’6 dB</strong> â†’ SWR 3:1, mismatch loss 1.25 dB (significant reflection)<br>â€¢ <strong>S11 = âˆ’10 dB</strong> â†’ SWR 1.9:1, mismatch loss 0.46 dB (moderate)<br>â€¢ <strong>S11 = âˆ’14 dB</strong> â†’ SWR 1.5:1, mismatch loss 0.18 dB (good)<br>â€¢ <strong>S11 = âˆ’20 dB</strong> â†’ SWR 1.2:1, mismatch loss 0.04 dB (excellent)</p><div class="note">ğŸ’¡ If S11 is worse than âˆ’6 dB (SWR > 3:1), your divider impedance may not be well matched to the UnUn output. Double-check the wiring and resistor values.</div>',
  },
  pl: {
    title: 'Kalkulator strat <span>UnUn</span>',
    subtitle: 'Pomiar S21 z dzielnikiem L-pad na NanoVNA',
    diagram_title: 'Schemat poÅ‚Ä…czenia',
    lpad_title: 'Parametry dzielnika L-pad',
    r1_label: 'Râ‚ (szeregowy)', r2_label: 'Râ‚‚ (bocznikowy)',
    unun_title: 'Parametry UnUn',
    ratio_label: 'PrzeÅ‚oÅ¼enie impedancyjne (k)', z0_label: 'Zâ‚€ (impedancja VNA)',
    vna_title: 'Odczyty z NanoVNA',
    s21_label: 'S21 (LogMag, z markera)',
    freq_label: 'CzÄ™stotliwoÅ›Ä‡ (informacyjnie)',
    vna_note: 'ğŸ’¡ Zmierz S21 osobno na kaÅ¼dej czÄ™stotliwoÅ›ci pasma. Straty UnUn-a rosnÄ… z czÄ™stotliwoÅ›ciÄ… â€” sprawdÅº na 3.5, 7, 14, 21 i 28\u00A0MHz.',
    s11_toggle_title: 'S11 strata powrotna (analiza niedopasowania)',
    s11_toggle_desc: 'WÅ‚Ä…cz aby rozdzieliÄ‡ straty niedopasowania od strat dysypatywnych (cieplnych)',
    s11_label: 'S11 (LogMag, z markera)',
    s11_swr_label: 'SWR (obliczone)',
    s11_note: 'ğŸ’¡ Odczytaj S11 z <strong>tego samego markera</strong> co S21. Na NanoVNA: S11 to CH0 (TRACE 0), domyÅ›lnie wyÅ›wietlany. Odczytaj wartoÅ›ci z obu kanaÅ‚Ã³w przy tym samym markerze.',
    results_title: 'Wyniki',
    gauge_title: 'CaÅ‚kowite straty wtrÄ…ceniowe',
    zone_exc: 'â—‰ DoskonaÅ‚y < 0.5 dB', zone_good: 'â—‰ OK 0.5â€“1.0 dB', zone_poor: 'â—‰ SÅ‚aby > 1.0 dB',
    breakdown_title: 'RozkÅ‚ad strat',
    legend_mismatch: 'Niedopasowanie (odbicie)',
    legend_dissipative: 'Dysypatywne (ciepÅ‚o)',
    res_zunun: 'Z wyjÅ›cia UnUn (k Ã— Zâ‚€)',
    res_zin: 'Z wejÅ›cia dzielnika (Râ‚ + Râ‚‚â€–Zâ‚€)',
    res_zin_no_r2: 'Z obciÄ…Å¼enia (Râ‚ + Zâ‚€)',
    res_zref: 'Z odbita na stronÄ™ pierwotnÄ…',
    res_divloss: 'TÅ‚umienie dzielnika (teoretyczne)',
    res_divloss_no_r2: 'TÅ‚umienie Râ‚ (teoretyczne)',
    res_s21: 'S21 zmierzone (caÅ‚y tor)',
    res_s11: 'S11 zmierzone (strata powrotna)',
    res_mismatch: 'Straty niedopasowania (z SWR)',
    res_dissipative: 'Straty dysypatywne (ciepÅ‚o w rdzeniu/drucie)',
    formula_loss: 'Straty caÅ‚kowite',
    formula_mismatch: 'Niedopasowanie',
    formula_dissipative: 'Dysypatywne',
    gauge_negative: 'dB âš  ujemne',
    svg_dut: 'â† mierzymy', svg_series: 'szereg.', svg_shunt: 'bocznik',
    svg_signal: 'sygnaÅ‚ S21 â†’', svg_builtin: 'wbudowane 50Î©',
    r2_toggle_title: 'ZewnÄ™trzny rezystor Râ‚‚ (bocznik)',
    r2_toggle_desc: 'WyÅ‚Ä…cz jeÅ›li uÅ¼ywasz tylko wbudowanego 50 Î© portu 2 VNA',
    info_freq_title: 'Czy czÄ™stotliwoÅ›Ä‡ ma znaczenie?',
    info_freq_body: '<p><strong>Tak, i to bardzo.</strong> Straty UnUn-a zmieniajÄ… siÄ™ z czÄ™stotliwoÅ›ciÄ… â€” zwykle rosnÄ… w gÃ³rÄ™ pasma. Dlatego nie wystarczy jeden pomiar. PowinieneÅ› zmierzyÄ‡ S21 na kilku czÄ™stotliwoÅ›ciach (markerami) i porÃ³wnaÄ‡ straty osobno dla kaÅ¼dego pasma.</p><p><strong>Typowe zachowanie:</strong> na 3.5 MHz straty mogÄ… byÄ‡ 0.2 dB, na 14 MHz â€” 0.5 dB, a na 28 MHz â€” juÅ¼ 1+ dB. ZaleÅ¼y od materiaÅ‚u rdzenia (mix 43, 31, 61 itd.), liczby zwojÃ³w i konstrukcji.</p><p><strong>Dzielnik rezystancyjny</strong> jest szerokopasmowy i prawie nie zmienia siÄ™ z czÄ™stotliwoÅ›ciÄ… â€” pod warunkiem, Å¼e uÅ¼yjesz rezystorÃ³w <strong>nieindukcyjnych</strong> (metal film, SMD, kompozytowych).</p><div class="note warn">âš  <strong>Nie uÅ¼ywaj rezystorÃ³w drutowych!</strong> Ich indukcyjnoÅ›Ä‡ pasoÅ¼ytnicza zafaÅ‚szuje pomiar powyÅ¼ej ~10 MHz. Rezystory metalowarstwowe (metal film) lub SMD sÄ… OK.</div>',
    info_cal_title: 'Jak skalibrowaÄ‡ NanoVNA?',
    info_cal_body: '<p><strong>Kalibracja 2-portowa (SOLT + THRU)</strong> â€” kluczowa dla wiarygodnego S21:</p><p><strong>1.</strong> Ustaw zakres: <code>STIMULUS â†’ START 1 MHz</code>, <code>STOP 30 MHz</code></p><p><strong>2.</strong> PodÅ‚Ä…cz kable do obu portÃ³w â€” te same, ktÃ³re uÅ¼yjesz w pomiarze</p><p><strong>3.</strong> Kalibruj na koÅ„cÃ³wkach kabli:</p><p>â€¢ Port CH0: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Port CH1: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Razem: <code>THRU</code> (poÅ‚Ä…cz P1 z P2)</p><p><strong>4.</strong> <code>CAL â†’ SAVE â†’ SAVE 0</code></p><p><strong>5. Weryfikacja:</strong> podÅ‚Ä…cz THRU i sprawdÅº Å¼e S21 â‰ˆ 0 dB (Â±0.1 dB = OK)</p><div class="note">ğŸ’¡ Kalibracja jest waÅ¼na dla konkretnych kabli i zakresu czÄ™stotliwoÅ›ci. Zmienisz kable â€” kalibruj od nowa.</div><div class="note warn" style="margin-top:0.5rem">âš  Kalibruj <strong>bez</strong> UnUn-a i bez dzielnika. Kalibracja ustala punkt odniesienia na koÅ„cÃ³wkach kabli.</div>',
    info_proc_title: 'Procedura krok po kroku',
    info_proc_body: '<p><strong>1.</strong> Skalibruj NanoVNA (2-port, 1â€“30 MHz)</p><p><strong>2.</strong> WÅ‚Ä…cz: <code>DISPLAY â†’ TRACE â†’ CH1</code> â†’ <code>FORMAT â†’ LOGMAG</code></p><p><strong>3.</strong> PodÅ‚Ä…cz: P1 â†’ UnUn (50 Î©) â†’ wyjÅ›cie UnUn â†’ Râ‚ szereg. â†’ junction â†’ P2, Râ‚‚ od junction do GND</p><p><strong>4.</strong> Markery: <code>MARKER â†’ SELECT</code> na 3.5, 7, 14, 21, 28 MHz</p><p><strong>5.</strong> Odczytaj S21 [dB] z kaÅ¼dego markera â†’ wpisz tu</p><p><strong>6.</strong> Kalkulator odejmie tÅ‚umienie dzielnika = czyste straty UnUn-a</p><p><strong>7.</strong> Opcjonalnie: wÅ‚Ä…cz analizÄ™ S11, odczytaj S11 z CH0 przy tym samym markerze â†’ wpisz aby rozdzieliÄ‡ straty niedopasowania od cieplnych</p><div class="note">ğŸ’¡ <strong>Weryfikacja dzielnika:</strong> podÅ‚Ä…cz sam dzielnik (bez UnUn-a) P1 â†’ Râ‚ â†’ Râ‚‚ â†’ P2. S21 powinno zgadzaÄ‡ siÄ™ z wartoÅ›ciÄ… â€TÅ‚umienie dzielnika" z kalkulatora (Â±0.2 dB).</div>',
    info_s11_title: 'Co to jest S11 i jak dziaÅ‚a analiza niedopasowania?',
    info_s11_body: '<p><strong>S21 mierzy caÅ‚kowite straty wtrÄ…ceniowe</strong> â€” ale nie mÃ³wi <em>dlaczego</em> tracisz moc. SÄ… dwa zasadniczo rÃ³Å¼ne mechanizmy strat:</p><p><strong>Straty niedopasowania (moc odbita)</strong> â€” gdy transformator nie prezentuje dokÅ‚adnie 50 Î© na porcie 1, czÄ™Å›Ä‡ mocy odbija siÄ™ z powrotem do ÅºrÃ³dÅ‚a. Ta moc nie zamienia siÄ™ w ciepÅ‚o â€” po prostu wraca. W prawdziwym nadajniku moc odbita jest ponownie odbijana i w wiÄ™kszoÅ›ci trafia do anteny (w systemach z coaxem), wiÄ™c straty niedopasowania sÄ… czÄ™sto mniej szkodliwe niÅ¼ wyglÄ…dajÄ….</p><p><strong>Straty dysypatywne (ciepÅ‚o)</strong> â€” moc faktycznie pochÅ‚aniana przez rdzeÅ„ ferrytowy (histereza + prÄ…dy wirowe) i rezystancjÄ™ uzwojenia. To jest â€prawdziwa" strata â€” energia zamieniona na ciepÅ‚o, ktÃ³ra nigdy nie dotrze do anteny. To degraduje twÃ³j sygnaÅ‚ i moÅ¼e przegrzaÄ‡ transformator przy wyÅ¼szej mocy.</p><p><strong>S11 (strata powrotna)</strong> mÃ³wi ile mocy odbija siÄ™ z portu 1. Z S11 obliczasz wspÃ³Å‚czynnik odbicia Î“ i stratÄ™ niedopasowania:</p><p><code>|Î“| = 10^(S11_dB / 20)</code><br><code>Strata niedopasowania = âˆ’10Â·logâ‚â‚€(1 âˆ’ |Î“|Â²)</code> dB<br><code>SWR = (1 + |Î“|) / (1 âˆ’ |Î“|)</code></p><p><strong>Straty dysypatywne = Straty caÅ‚kowite âˆ’ Straty niedopasowania</strong></p><p>To jest liczba, ktÃ³ra naprawdÄ™ ma znaczenie. Transformator z 2 dB strat caÅ‚kowitych ale 1.5 dB z niedopasowania jest znacznie lepszy niÅ¼ taki z 2 dB ale tylko 0.2 dB niedopasowania â€” bo ten drugi spala 1.8 dB jako ciepÅ‚o.</p><div class="note info-orange">âš  <strong>Uwaga:</strong> Ten podziaÅ‚ jest przybliÅ¼ony. W prawdziwym transformatorze niedopasowanie i dysypacja oddziaÅ‚ujÄ… na siebie â€” fale odbite przechodzÄ… przez stratny materiaÅ‚ wielokrotnie. Ale do praktycznej oceny domowych UnUn-Ã³w to przybliÅ¼enie jest bardzo uÅ¼yteczne.</div>',
    info_s11_howto_title: 'Jak zmierzyÄ‡ S11 na NanoVNA',
    info_s11_howto_body: '<p><strong>Dobra wiadomoÅ›Ä‡: NanoVNA mierzy S11 i S21 jednoczeÅ›nie.</strong> Nie potrzebujesz osobnego pomiaru â€” oba sÄ… dostÄ™pne z tego samego sweepa.</p><p><strong>1.</strong> Z podÅ‚Ä…czonym ukÅ‚adem (P1 â†’ UnUn â†’ dzielnik â†’ P2), VNA juÅ¼ mierzy zarÃ³wno S11 jak i S21.</p><p><strong>2.</strong> S11 jest na <code>CH0 / TRACE 0</code> â€” domyÅ›lnie wyÅ›wietlany. Upewnij siÄ™ Å¼e format to <code>LOGMAG</code>.</p><p><strong>3.</strong> S21 jest na <code>CH1 / TRACE 1</code>.</p><p><strong>4.</strong> Ustaw marker na czÄ™stotliwoÅ›ci (np. 7.1 MHz).</p><p><strong>5.</strong> Odczyt markera pokazuje wartoÅ›ci dla wszystkich aktywnych trace\'Ã³w. Odczytaj <strong>S11 z CH0</strong> i <strong>S21 z CH1</strong> przy tej samej pozycji markera.</p><p><strong>6.</strong> JeÅ›li widzisz tylko jeden trace, wÅ‚Ä…cz oba: <code>DISPLAY â†’ TRACE â†’ TRACE 0</code> (S11) i <code>TRACE 1</code> (S21). Oba w formacie LOGMAG.</p><p><strong>Czego siÄ™ spodziewaÄ‡:</strong></p><p>â€¢ <strong>S11 = âˆ’6 dB</strong> â†’ SWR 3:1, straty niedopasowania 1.25 dB (znaczne odbicie)<br>â€¢ <strong>S11 = âˆ’10 dB</strong> â†’ SWR 1.9:1, straty niedopasowania 0.46 dB (umiarkowane)<br>â€¢ <strong>S11 = âˆ’14 dB</strong> â†’ SWR 1.5:1, straty niedopasowania 0.18 dB (dobre)<br>â€¢ <strong>S11 = âˆ’20 dB</strong> â†’ SWR 1.2:1, straty niedopasowania 0.04 dB (doskonaÅ‚e)</p><div class="note">ğŸ’¡ JeÅ›li S11 jest gorsze niÅ¼ âˆ’6 dB (SWR > 3:1), impedancja dzielnika moÅ¼e nie byÄ‡ dobrze dopasowana do wyjÅ›cia UnUn-a. SprawdÅº poÅ‚Ä…czenia i wartoÅ›ci rezystorÃ³w.</div>',
  }
};

let currentLang = 'en';
let r2Enabled = true;
let s11Enabled = false;

function setLang(lang) {
  currentLang = lang;
  document.getElementById('btn-en').classList.toggle('active', lang === 'en');
  document.getElementById('btn-pl').classList.toggle('active', lang === 'pl');
  document.documentElement.lang = lang;
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (i18n[lang][key] !== undefined) {
      el.tagName === 'H1' || key === 'title'
        ? el.innerHTML = i18n[lang][key]
        : el.textContent = i18n[lang][key];
    }
  });
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    const key = el.getAttribute('data-i18n-html');
    if (i18n[lang][key] !== undefined) el.innerHTML = i18n[lang][key];
  });
  document.querySelectorAll('[data-i18n-svg]').forEach(el => {
    const key = el.getAttribute('data-i18n-svg');
    if (i18n[lang][key] !== undefined) el.textContent = i18n[lang][key];
  });
  updateDynamicLabels();
  calculate();
}

function toggleR2() {
  r2Enabled = document.getElementById('r2-toggle').checked;
  document.getElementById('r2-input-row').classList.toggle('disabled', !r2Enabled);
  document.getElementById('svg-r2-group').classList.toggle('hidden', !r2Enabled);
  document.getElementById('svg-junction').style.opacity = r2Enabled ? '1' : '0.3';
  document.getElementById('svg-builtin-label').style.opacity = r2Enabled ? '0' : '1';
  updateDynamicLabels();
  calculate();
}

function toggleS11() {
  s11Enabled = document.getElementById('s11-toggle').checked;
  document.getElementById('s11-section').style.display = s11Enabled ? 'block' : 'none';
  document.getElementById('loss-breakdown').style.display = s11Enabled ? 'block' : 'none';
  document.getElementById('row-s11').classList.toggle('hidden', !s11Enabled);
  document.getElementById('row-mismatch').classList.toggle('hidden', !s11Enabled);
  document.getElementById('row-dissipative').classList.toggle('hidden', !s11Enabled);
  document.getElementById('info-s11-section').style.display = s11Enabled ? '' : 'none';
  document.getElementById('info-s11-howto').style.display = s11Enabled ? '' : 'none';
  updateDynamicLabels();
  calculate();
}

function updateDynamicLabels() {
  const t = i18n[currentLang];
  document.getElementById('lbl-zin').textContent = r2Enabled ? t.res_zin : t.res_zin_no_r2;
  // Formula
  const fb = document.getElementById('formula-block');
  const fl = t.formula_loss, fm = t.formula_mismatch, fd = t.formula_dissipative;
  let html;
  if (r2Enabled) {
    html = '<span class="hl">Râ‚‚â€–Zâ‚€</span> = Râ‚‚Â·Zâ‚€ / (Râ‚‚+Zâ‚€)<br>' +
      '<span class="hl3">S21_div</span> = 10Â·logâ‚â‚€( 4Â·Z_sÂ·(Râ‚‚â€–Zâ‚€)Â² / ((Z_s+Râ‚+Râ‚‚â€–Zâ‚€)Â²Â·Zâ‚€) )<br>' +
      '<span class="hl2">' + fl + '</span> = <span class="hl3">S21_div</span> âˆ’ S21_measured';
  } else {
    html = '<span class="hl3">S21_Râ‚</span> = 10Â·logâ‚â‚€( 4Â·Z_sÂ·Zâ‚€ / (Z_s+Râ‚+Zâ‚€)Â² )<br>' +
      '<span class="hl2">' + fl + '</span> = <span class="hl3">S21_Râ‚</span> âˆ’ S21_measured';
  }
  if (s11Enabled) {
    html += '<br><br><span class="hl4">' + fm + '</span> = âˆ’10Â·logâ‚â‚€(1 âˆ’ |Î“|Â²)  where |Î“| = 10^(S11/20)<br>' +
      '<span class="hl2">' + fd + '</span> = ' + fl + ' âˆ’ <span class="hl4">' + fm + '</span>';
  }
  fb.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getGaugeColor(loss) {
  if (loss < 0) return '#a78bfa';
  if (loss <= 0.5) return '#6bcf7f';
  if (loss <= 1.0) { const t=(loss-0.5)/0.5; return `rgb(${Math.round(107+(255-107)*t)},${Math.round(207+(230-207)*t)},${Math.round(127+(109-127)*t)})`; }
  if (loss <= 2.0) { const t=(loss-1.0)/1.0; return `rgb(255,${Math.round(230+(107-230)*t)},${Math.round(109+(107-109)*t)})`; }
  return '#ff6b6b';
}

function calculate() {
  const R1 = parseFloat(document.getElementById('r1').value) || 0;
  const R2 = parseFloat(document.getElementById('r2').value) || 0;
  const k  = parseFloat(document.getElementById('ratio').value) || 25;
  const Z0 = parseFloat(document.getElementById('z0').value) || 50;
  const S21meas = parseFloat(document.getElementById('s21measured').value) || 0;

  const Zunun = k * Z0;
  const Zs = Zunun;
  const R2par = r2Enabled ? (R2 * Z0) / (R2 + Z0) : Z0;
  const Zin_div = R1 + R2par;
  const Zreflected = Zin_div / k;
  const Ztotal = Zs + R1 + R2par;
  const S21sq = (4 * Zs * R2par * R2par) / (Ztotal * Ztotal * Z0);
  const S21div_dB = 10 * Math.log10(S21sq);
  const totalLoss = S21div_dB - S21meas;

  // Text results
  document.getElementById('out-zunun').textContent = Zunun.toFixed(1) + ' Î©';
  document.getElementById('out-zin').textContent = Zin_div.toFixed(1) + ' Î©';
  document.getElementById('out-divloss').textContent = S21div_dB.toFixed(2) + ' dB';
  document.getElementById('out-s21meas').textContent = S21meas.toFixed(1) + ' dB';

  const zrefEl = document.getElementById('out-zreflected');
  const mismatch_pct = Math.abs(Zreflected - Z0) / Z0 * 100;
  zrefEl.textContent = Zreflected.toFixed(1) + ' Î©';
  if (mismatch_pct < 5) { zrefEl.style.color='var(--green)'; zrefEl.textContent+=' âœ“'; }
  else if (mismatch_pct < 15) { zrefEl.style.color='var(--yellow)'; zrefEl.textContent+=' ~'; }
  else { zrefEl.style.color='var(--red)'; zrefEl.textContent+=' âœ—'; }

  // S11 / mismatch
  let mismatchLoss = 0, dissipativeLoss = totalLoss;
  if (s11Enabled) {
    const S11meas = parseFloat(document.getElementById('s11measured').value) || 0;
    const gammaLin = Math.pow(10, S11meas / 20);
    const gammaSq = gammaLin * gammaLin;
    const swr = (1 + gammaLin) / (1 - gammaLin);

    mismatchLoss = -10 * Math.log10(1 - gammaSq);
    if (!isFinite(mismatchLoss) || mismatchLoss < 0) mismatchLoss = 0;
    dissipativeLoss = Math.max(0, totalLoss - mismatchLoss);

    document.getElementById('s11-swr').value = isFinite(swr) && swr > 0 ? swr.toFixed(2) : 'âˆ';
    document.getElementById('out-s11').textContent = S11meas.toFixed(1) + ' dB';
    document.getElementById('out-mismatch').textContent = mismatchLoss.toFixed(2) + ' dB';
    document.getElementById('out-dissipative').textContent = dissipativeLoss.toFixed(2) + ' dB';

    // Breakdown bar
    const barTotal = Math.max(totalLoss, 0.01);
    const mPct = Math.max((mismatchLoss / barTotal) * 100, 0);
    const dPct = Math.max((dissipativeLoss / barTotal) * 100, 0);
    document.getElementById('bar-mismatch').style.width = mPct + '%';
    document.getElementById('bar-mismatch').textContent = mismatchLoss >= 0.05 ? mismatchLoss.toFixed(1) + ' dB' : '';
    document.getElementById('bar-dissipative').style.width = dPct + '%';
    document.getElementById('bar-dissipative').textContent = dissipativeLoss >= 0.05 ? dissipativeLoss.toFixed(1) + ' dB' : '';
    document.getElementById('legend-mismatch-val').textContent = mismatchLoss.toFixed(2) + ' dB';
    document.getElementById('legend-dissipative-val').textContent = dissipativeLoss.toFixed(2) + ' dB';
  }

  // Gauge
  const absLoss = Math.max(0, totalLoss);
  const pct = Math.min(absLoss / 3.0 * 100, 100);
  const color = getGaugeColor(totalLoss);
  const fill = document.getElementById('gauge-fill');
  const glow = document.getElementById('gauge-glow');
  fill.style.width = pct + '%';
  fill.style.backgroundColor = color;
  fill.style.boxShadow = `0 0 16px ${color}44, 0 0 4px ${color}88`;
  glow.style.backgroundColor = color;

  const gaugeVal = document.getElementById('gauge-val');
  const t = i18n[currentLang];
  if (totalLoss < 0) {
    gaugeVal.innerHTML = Math.abs(totalLoss).toFixed(2) + ' <span class="unit-sm">' + t.gauge_negative + '</span>';
  } else {
    gaugeVal.innerHTML = totalLoss.toFixed(2) + ' <span class="unit-sm">dB</span>';
  }
  gaugeVal.style.color = color;

  const zones = [
    { el: document.getElementById('zt-exc'),  active: totalLoss >= 0 && totalLoss <= 0.5 },
    { el: document.getElementById('zt-good'), active: totalLoss > 0.5 && totalLoss <= 1.0 },
    { el: document.getElementById('zt-poor'), active: totalLoss > 1.0 },
  ];
  zones.forEach(z => {
    z.el.className = z.el.className.replace(/\s*(active|inactive)/g, '');
    z.el.classList.add((totalLoss < 0 ? false : z.active) ? 'active' : 'inactive');
  });
}

calculate();
</script>

<noscript>
  <p style="color:#ff6b6b;text-align:center;padding:2rem;">This calculator requires JavaScript. / Ten kalkulator wymaga JavaScript.</p>
</noscript>

</body>
</html>
