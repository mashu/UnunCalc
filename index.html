<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Kalkulator strat transformatora UnUn z pomiaru S21 na NanoVNA z dzielnikiem L-pad">
<meta name="author" content="SA0KAM">
<meta property="og:title" content="Kalkulator strat UnUn ‚Äî NanoVNA + L-pad">
<meta property="og:description" content="Oblicz straty transformatora impedancyjnego UnUn na podstawie pomiaru S21 z NanoVNA i dzielnika rezystancyjnego L-pad.">
<meta property="og:url" content="https://mashu.github.io/UnunCalc/">
<meta property="og:type" content="website">
<link rel="canonical" href="https://mashu.github.io/UnunCalc/">
<title>Kalkulator strat UnUn ‚Äî NanoVNA + L-pad</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #0c1017;
    --surface: #141b24;
    --surface2: #1c2533;
    --surface3: #243040;
    --border: #2a3648;
    --text: #cdd6e0;
    --text-dim: #6b7a8d;
    --accent: #4ecdc4;
    --accent-dim: #2a7a74;
    --red: #ff6b6b;
    --yellow: #ffe66d;
    --blue: #5b9bd5;
    --purple: #a78bfa;
    --green: #6bcf7f;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    padding: 1.5rem;
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
  }

  header {
    margin-bottom: 2rem;
  }

  h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #fff;
    letter-spacing: -0.03em;
  }

  h1 span { color: var(--accent); }

  .subtitle {
    color: var(--text-dim);
    font-size: 0.88rem;
    margin-top: 0.3rem;
  }

  /* ‚îÄ‚îÄ DIAGRAM ‚îÄ‚îÄ */
  .diagram-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
  }

  .diagram-section h2 {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-dim);
    margin-bottom: 1rem;
  }

  /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
  }

  .card-title {
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-dim);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .card-title .dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    display: inline-block;
  }

  .input-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .input-group.full {
    grid-column: 1 / -1;
  }

  .input-group label {
    font-size: 0.82rem;
    color: var(--text-dim);
    font-weight: 500;
  }

  .input-row {
    display: flex;
    align-items: stretch;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: var(--surface2);
    transition: border-color 0.2s;
  }

  .input-row:focus-within {
    border-color: var(--accent);
  }

  .input-row input {
    flex: 1;
    background: transparent;
    border: none;
    color: #fff;
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 600;
    padding: 0.65rem 0.75rem;
    outline: none;
    min-width: 0;
  }

  .input-row input::placeholder {
    color: var(--text-dim);
    font-weight: 400;
  }

  .input-row .unit {
    display: flex;
    align-items: center;
    padding: 0 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-dim);
    background: var(--surface3);
    border-left: 1px solid var(--border);
    white-space: nowrap;
  }

  /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
  .results {
    background: var(--surface);
    border: 1px solid var(--accent-dim);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
  }

  .result-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
  }

  .result-row:last-child { border-bottom: none; }

  .result-label {
    font-size: 0.88rem;
    color: var(--text-dim);
  }

  .result-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.05rem;
    font-weight: 700;
    color: #fff;
  }

  .result-value.accent { color: var(--accent); }
  .result-value.red { color: var(--red); }
  .result-value.yellow { color: var(--yellow); }
  .result-value.green { color: var(--green); }
  .result-value.blue { color: var(--blue); }

  .big-result {
    text-align: center;
    padding: 1.2rem 0 0.6rem;
  }

  .big-result .label {
    font-size: 0.82rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 0.3rem;
  }

  .big-result .value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2.2rem;
    font-weight: 700;
  }

  .big-result .unit-label {
    font-size: 1rem;
    color: var(--text-dim);
    font-weight: 400;
  }

  .quality-badge {
    display: inline-block;
    padding: 0.2rem 0.8rem;
    border-radius: 20px;
    font-size: 0.78rem;
    font-weight: 600;
    margin-top: 0.5rem;
  }

  .q-excellent { background: #1a3a1a; color: var(--green); border: 1px solid #2a5a2a; }
  .q-good { background: #2a3a1a; color: var(--yellow); border: 1px solid #4a5a2a; }
  .q-poor { background: #3a1a1a; color: var(--red); border: 1px solid #5a2a2a; }

  .note {
    background: #1a2030;
    border-left: 3px solid var(--blue);
    padding: 0.75rem 1rem;
    margin-top: 1rem;
    border-radius: 0 8px 8px 0;
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.5;
  }

  .formula-display {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin-top: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.7;
  }

  .formula-display .hl { color: var(--accent); font-weight: 600; }
  .formula-display .hl2 { color: var(--red); font-weight: 600; }
  .formula-display .hl3 { color: var(--yellow); font-weight: 600; }

  @media (max-width: 500px) {
    .input-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="container">

  <header>
    <h1>Kalkulator strat <span>UnUn</span></h1>
    <p class="subtitle">Pomiar S21 z dzielnikiem L-pad na NanoVNA</p>
  </header>

  <!-- SCHEMAT -->
  <div class="diagram-section">
    <h2>Schemat po≈ÇƒÖczenia</h2>
    <svg viewBox="0 0 680 180" width="100%" style="display:block;">
      <defs>
        <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="#ffe66d"/>
        </marker>
      </defs>

      <!-- VNA P1 -->
      <rect x="5" y="45" width="90" height="70" rx="6" fill="#1e3a5f" stroke="#5b9bd5" stroke-width="1.5"/>
      <text x="50" y="72" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono" font-size="11" font-weight="700">VNA P1</text>
      <text x="50" y="90" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono" font-size="9" opacity="0.7">50 Œ©</text>

      <line x1="95" y1="75" x2="160" y2="75" stroke="#5b9bd5" stroke-width="2"/>

      <!-- UnUn -->
      <rect x="160" y="40" width="110" height="80" rx="6" fill="#3a1e1e" stroke="#ff6b6b" stroke-width="1.5"/>
      <text x="215" y="68" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono" font-size="11" font-weight="700">UnUn</text>
      <text x="215" y="85" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono" font-size="9" opacity="0.7">1:k</text>
      <text x="215" y="108" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono" font-size="8" opacity="0.5">‚Üê mierzymy</text>

      <line x1="270" y1="75" x2="320" y2="75" stroke="#ff6b6b" stroke-width="2"/>

      <!-- R1 series -->
      <rect x="320" y="62" width="80" height="26" rx="4" fill="none" stroke="#4ecdc4" stroke-width="1.5"/>
      <text x="360" y="80" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono" font-size="10" font-weight="600">R‚ÇÅ</text>
      <text x="360" y="55" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono" font-size="8">szereg.</text>

      <line x1="400" y1="75" x2="460" y2="75" stroke="#4ecdc4" stroke-width="2"/>

      <!-- Junction -->
      <circle cx="460" cy="75" r="3" fill="#4ecdc4"/>

      <!-- R2 shunt -->
      <line x1="460" y1="78" x2="460" y2="98" stroke="#4ecdc4" stroke-width="1.5"/>
      <rect x="448" y="98" width="24" height="42" rx="4" fill="none" stroke="#4ecdc4" stroke-width="1.5"/>
      <text x="460" y="123" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono" font-size="9" font-weight="600">R‚ÇÇ</text>
      <line x1="460" y1="140" x2="460" y2="160" stroke="#6b8e5a" stroke-width="1.5" stroke-dasharray="4,2"/>
      <text x="485" y="125" text-anchor="start" fill="#4ecdc4" font-family="JetBrains Mono" font-size="8">bocznik</text>

      <!-- Wire to P2 -->
      <line x1="460" y1="75" x2="575" y2="75" stroke="#5b9bd5" stroke-width="2"/>

      <!-- VNA P2 -->
      <rect x="575" y="45" width="90" height="70" rx="6" fill="#1e3a5f" stroke="#5b9bd5" stroke-width="1.5"/>
      <text x="620" y="72" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono" font-size="11" font-weight="700">VNA P2</text>
      <text x="620" y="90" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono" font-size="9" opacity="0.7">50 Œ©</text>

      <!-- GND -->
      <line x1="50" y1="115" x2="50" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="30" y1="160" x2="650" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="620" y1="115" x2="620" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="340" y="175" text-anchor="middle" fill="#6b8e5a" font-family="JetBrains Mono" font-size="9">GND</text>

      <!-- Arrow -->
      <line x1="130" y1="30" x2="530" y2="30" stroke="#ffe66d" stroke-width="1" marker-end="url(#arr)" opacity="0.5"/>
      <text x="330" y="25" text-anchor="middle" fill="#ffe66d" font-family="JetBrains Mono" font-size="8" opacity="0.6">sygna≈Ç S21</text>
    </svg>
  </div>

  <!-- PARAMETRY DZIELNIKA -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--accent)"></span> Parametry dzielnika L-pad</div>
    <div class="input-grid">
      <div class="input-group">
        <label>R‚ÇÅ (szeregowy)</label>
        <div class="input-row">
          <input type="number" id="r1" value="1206.9" step="0.1" oninput="calculate()">
          <span class="unit">Œ©</span>
        </div>
      </div>
      <div class="input-group">
        <label>R‚ÇÇ (bocznikowy)</label>
        <div class="input-row">
          <input type="number" id="r2" value="50.034" step="0.001" oninput="calculate()">
          <span class="unit">Œ©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- PARAMETRY UNUN -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--red)"></span> Parametry UnUn</div>
    <div class="input-grid">
      <div class="input-group">
        <label>Prze≈Ço≈ºenie impedancyjne (k)</label>
        <div class="input-row">
          <input type="number" id="ratio" value="25" step="1" oninput="calculate()">
          <span class="unit">: 1</span>
        </div>
      </div>
      <div class="input-group">
        <label>Z‚ÇÄ (impedancja VNA)</label>
        <div class="input-row">
          <input type="number" id="z0" value="50" step="1" oninput="calculate()">
          <span class="unit">Œ©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ODCZYT Z VNA -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--yellow)"></span> Odczyt z NanoVNA</div>
    <div class="input-grid">
      <div class="input-group full">
        <label>Zmierzony S21 (LogMag) ‚Äî odczytaj z markera</label>
        <div class="input-row">
          <input type="number" id="s21measured" value="-21.5" step="0.1" oninput="calculate()">
          <span class="unit">dB</span>
        </div>
      </div>
    </div>
  </div>

  <!-- WYNIKI -->
  <div class="results" id="results">
    <div class="card-title"><span class="dot" style="background:var(--green)"></span> Wyniki</div>

    <div class="result-row">
      <span class="result-label">Z wyj≈õcia UnUn (k √ó Z‚ÇÄ)</span>
      <span class="result-value blue" id="out-zunun">1250.0 Œ©</span>
    </div>
    <div class="result-row">
      <span class="result-label">Z wej≈õcia dzielnika</span>
      <span class="result-value accent" id="out-zin">1231.9 Œ©</span>
    </div>
    <div class="result-row">
      <span class="result-label">Z odbite na pierwotnƒÖ (dopasowanie P1)</span>
      <span class="result-value" id="out-zreflected">49.3 Œ©</span>
    </div>
    <div class="result-row">
      <span class="result-label">T≈Çumienie dzielnika (teoretyczne)</span>
      <span class="result-value yellow" id="out-divloss">‚àí19.9 dB</span>
    </div>
    <div class="result-row">
      <span class="result-label">Zmierzony S21 (ca≈Çy tor)</span>
      <span class="result-value" id="out-s21meas">‚àí21.5 dB</span>
    </div>

    <div class="big-result">
      <div class="label">Straty transformatora UnUn</div>
      <div class="value" id="out-loss" style="color:var(--red)">1.6 <span class="unit-label">dB</span></div>
      <div><span class="quality-badge" id="out-badge">‚Äî</span></div>
    </div>

    <div class="formula-display">
      <span class="hl3">S21_dzielnika</span> = 10¬∑log‚ÇÅ‚ÇÄ(4¬∑Zs¬∑R‚ÇÇ‚Äñ¬≤  / ((Zs+R‚ÇÅ+R‚ÇÇ‚Äñ)¬≤¬∑Z‚ÇÄ))<br>
      <span class="hl2">Straty UnUn</span> = <span class="hl3">S21_dzielnika</span> ‚àí S21_zmierzone
    </div>

    <div class="note">
      üí° Dobry UnUn na pasmach KF powinien mieƒá straty &lt; 0.5 dB.
      Straty 0.5‚Äì1 dB to akceptowalny wynik. Powy≈ºej 1.5 dB ‚Äî sprawd≈∫ materia≈Ç rdzenia,
      liczbƒô zwoj√≥w i jako≈õƒá wykonania.
    </div>
  </div>

</div>

<script>
function calculate() {
  const R1 = parseFloat(document.getElementById('r1').value) || 0;
  const R2 = parseFloat(document.getElementById('r2').value) || 0;
  const k  = parseFloat(document.getElementById('ratio').value) || 25;
  const Z0 = parseFloat(document.getElementById('z0').value) || 50;
  const S21meas = parseFloat(document.getElementById('s21measured').value) || 0;

  // Impedancja wyj≈õciowa UnUn
  const Zunun = k * Z0;

  // R2 r√≥wnolegle z Z0 (obciƒÖ≈ºenie portu 2)
  const R2par = (R2 * Z0) / (R2 + Z0);

  // Impedancja wej≈õciowa dzielnika
  const Zin_div = R1 + R2par;

  // Impedancja odbita na stronƒô pierwotnƒÖ transformatora
  const Zreflected = Zin_div / k;

  // Zs = impedancja Thevenin po transformatorze (= k * Z0)
  const Zs = Zunun;

  // Ztotal = Zs + R1 + R2par (pe≈Çna pƒôtla od ≈∫r√≥d≈Ça Thevenin)
  const Ztotal = Zs + R1 + R2par;

  // Transducer gain |S21|^2 for ideal (lossless) transformer + L-pad
  // |S21|^2 = P_load / P_avail = 4 * Zs * R2par^2 / (Ztotal^2 * Z0)
  const S21sq = (4 * Zs * R2par * R2par) / (Ztotal * Ztotal * Z0);

  // S21 dzielnika w dB (z idealnym trafo)
  const S21div_dB = 10 * Math.log10(S21sq);

  // Straty UnUn = t≈Çumienie dzielnika (ujemne) minus zmierzone S21 (bardziej ujemne)
  // Np: -19.9 - (-21.5) = 1.6 dB strat
  const loss = S21div_dB - S21meas;

  // Aktualizacja wynik√≥w
  document.getElementById('out-zunun').textContent = Zunun.toFixed(1) + ' Œ©';
  document.getElementById('out-zin').textContent = Zin_div.toFixed(1) + ' Œ©';
  document.getElementById('out-zreflected').textContent = Zreflected.toFixed(1) + ' Œ©';
  document.getElementById('out-divloss').textContent = S21div_dB.toFixed(2) + ' dB';
  document.getElementById('out-s21meas').textContent = S21meas.toFixed(1) + ' dB';

  const lossEl = document.getElementById('out-loss');
  lossEl.innerHTML = Math.abs(loss).toFixed(2) + ' <span class="unit-label">dB</span>';

  const badge = document.getElementById('out-badge');
  if (loss < 0) {
    lossEl.style.color = 'var(--purple)';
    badge.textContent = '‚ö† Wynik ujemny ‚Äî sprawd≈∫ po≈ÇƒÖczenia';
    badge.className = 'quality-badge q-poor';
  } else if (loss <= 0.5) {
    lossEl.style.color = 'var(--green)';
    badge.textContent = '‚úì Doskona≈Çy';
    badge.className = 'quality-badge q-excellent';
  } else if (loss <= 1.0) {
    lossEl.style.color = 'var(--yellow)';
    badge.textContent = '‚óã Akceptowalny';
    badge.className = 'quality-badge q-good';
  } else if (loss <= 1.5) {
    lossEl.style.color = 'var(--red)';
    badge.textContent = '‚ñ≥ S≈Çaby';
    badge.className = 'quality-badge q-poor';
  } else {
    lossEl.style.color = 'var(--red)';
    badge.textContent = '‚úó Z≈Çy ‚Äî sprawd≈∫ rdze≈Ñ i wykonanie';
    badge.className = 'quality-badge q-poor';
  }

  // Sprawdzenie dopasowania
  const zrefEl = document.getElementById('out-zreflected');
  const mismatch = Math.abs(Zreflected - Z0) / Z0 * 100;
  if (mismatch < 5) {
    zrefEl.style.color = 'var(--green)';
    zrefEl.textContent += ' ‚úì';
  } else if (mismatch < 15) {
    zrefEl.style.color = 'var(--yellow)';
    zrefEl.textContent += ' ~';
  } else {
    zrefEl.style.color = 'var(--red)';
    zrefEl.textContent += ' ‚úó niedopasowanie!';
  }
}

// Oblicz przy starcie
calculate();
</script>

<noscript>
  <p style="color:#ff6b6b;text-align:center;padding:2rem;">Ten kalkulator wymaga w≈ÇƒÖczonego JavaScript.</p>
</noscript>

</body>
</html>
