<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Calculate UnUn transformer insertion loss from NanoVNA S21 measurement with L-pad resistive divider">
<meta name="author" content="SA0KAM">
<meta property="og:title" content="UnUn Loss Calculator â€” NanoVNA + L-pad">
<meta property="og:description" content="Calculate UnUn transformer insertion loss from NanoVNA S21 measurement with L-pad resistive divider.">
<meta property="og:url" content="https://mashu.github.io/UnunCalc/">
<meta property="og:type" content="website">
<link rel="canonical" href="https://mashu.github.io/UnunCalc/">
<title>UnUn Loss Calculator â€” NanoVNA + L-pad</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap');

  :root {
    --bg: #0c1017;
    --surface: #141b24;
    --surface2: #1c2533;
    --surface3: #243040;
    --border: #2a3648;
    --text: #cdd6e0;
    --text-dim: #6b7a8d;
    --accent: #4ecdc4;
    --accent-dim: #2a7a74;
    --red: #ff6b6b;
    --yellow: #ffe66d;
    --blue: #5b9bd5;
    --purple: #a78bfa;
    --green: #6bcf7f;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    padding: 1.5rem;
  }

  .container { max-width: 720px; margin: 0 auto; }

  header {
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #fff;
    letter-spacing: -0.03em;
  }

  h1 span { color: var(--accent); }

  .subtitle {
    color: var(--text-dim);
    font-size: 0.88rem;
    margin-top: 0.3rem;
  }

  /* â”€â”€ LANG TOGGLE â”€â”€ */
  .lang-toggle {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.3rem;
    flex-shrink: 0;
    margin-top: 0.2rem;
  }

  .lang-btn {
    background: transparent;
    border: none;
    color: var(--text-dim);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.78rem;
    font-weight: 600;
    padding: 0.3rem 0.6rem;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.25s;
  }

  .lang-btn.active {
    background: var(--accent-dim);
    color: var(--accent);
  }

  .lang-btn:hover:not(.active) {
    color: var(--text);
  }

  /* â”€â”€ DIAGRAM â”€â”€ */
  .diagram-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
  }

  .diagram-section h2 {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-dim);
    margin-bottom: 1rem;
  }

  /* â”€â”€ CARDS â”€â”€ */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
  }

  .card-title {
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-dim);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .card-title .dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    display: inline-block;
  }

  .input-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .input-group.full { grid-column: 1 / -1; }

  .input-group label {
    font-size: 0.82rem;
    color: var(--text-dim);
    font-weight: 500;
  }

  .input-row {
    display: flex;
    align-items: stretch;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: var(--surface2);
    transition: border-color 0.2s;
  }

  .input-row:focus-within { border-color: var(--accent); }

  .input-row input {
    flex: 1;
    background: transparent;
    border: none;
    color: #fff;
    font-family: 'JetBrains Mono', monospace;
    font-size: 1rem;
    font-weight: 600;
    padding: 0.65rem 0.75rem;
    outline: none;
    min-width: 0;
  }

  .input-row input::placeholder {
    color: var(--text-dim);
    font-weight: 400;
  }

  .input-row .unit {
    display: flex;
    align-items: center;
    padding: 0 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-dim);
    background: var(--surface3);
    border-left: 1px solid var(--border);
    white-space: nowrap;
  }

  /* â”€â”€ GAUGE â”€â”€ */
  .gauge-container { padding: 1.5rem 0 1rem; }

  .gauge-label-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 0.5rem;
  }

  .gauge-title {
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-dim);
  }

  .gauge-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.8rem;
    font-weight: 700;
    transition: color 0.5s ease;
  }

  .gauge-value .unit-sm {
    font-size: 0.9rem;
    font-weight: 400;
    color: var(--text-dim);
  }

  .gauge-track {
    position: relative;
    height: 14px;
    border-radius: 7px;
    background: var(--surface3);
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
  }

  .gauge-fill {
    position: absolute;
    left: 0; top: 0; bottom: 0;
    border-radius: 7px;
    transition: width 0.6s cubic-bezier(0.34, 1.4, 0.64, 1),
                background-color 0.5s ease;
    min-width: 4px;
  }

  .gauge-glow {
    position: absolute;
    right: -2px; top: -3px; bottom: -3px;
    width: 8px;
    border-radius: 50%;
    filter: blur(4px);
    transition: background-color 0.5s ease;
    pointer-events: none;
  }

  .gauge-ticks {
    display: flex;
    justify-content: space-between;
    margin-top: 0.35rem;
    padding: 0 2px;
  }

  .gauge-ticks span {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-dim);
  }

  .gauge-zones {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.7rem;
    flex-wrap: wrap;
  }

  .zone-tag {
    font-size: 0.72rem;
    padding: 0.2rem 0.6rem;
    border-radius: 4px;
    font-weight: 600;
    transition: opacity 0.4s, transform 0.4s cubic-bezier(0.34, 1.4, 0.64, 1);
  }

  .zone-tag.active { transform: scale(1.1); opacity: 1; }
  .zone-tag.inactive { opacity: 0.25; transform: scale(1); }

  .zt-excellent { background: #122b12; color: var(--green); border: 1px solid #1a3d1a; }
  .zt-good { background: #2a2a10; color: var(--yellow); border: 1px solid #3d3d1a; }
  .zt-poor { background: #2a1515; color: var(--red); border: 1px solid #3d1a1a; }

  /* â”€â”€ RESULTS â”€â”€ */
  .results {
    background: var(--surface);
    border: 1px solid var(--accent-dim);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
  }

  .result-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
  }

  .result-row:last-child { border-bottom: none; }

  .result-label {
    font-size: 0.88rem;
    color: var(--text-dim);
  }

  .result-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.05rem;
    font-weight: 700;
    color: #fff;
    transition: color 0.3s;
  }

  .result-value.accent { color: var(--accent); }
  .result-value.blue { color: var(--blue); }

  .formula-display {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin-top: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.7;
  }

  .formula-display .hl { color: var(--accent); font-weight: 600; }
  .formula-display .hl2 { color: var(--red); font-weight: 600; }
  .formula-display .hl3 { color: var(--yellow); font-weight: 600; }

  /* â”€â”€ INFO SECTIONS â”€â”€ */
  .info-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 1.5rem;
  }

  .info-section summary {
    cursor: pointer;
    font-size: 0.88rem;
    font-weight: 600;
    color: var(--accent);
    list-style: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    user-select: none;
  }

  .info-section summary::-webkit-details-marker { display: none; }

  .info-section summary::before {
    content: 'â–¸';
    font-size: 0.8rem;
    transition: transform 0.2s;
    display: inline-block;
  }

  .info-section[open] summary::before { transform: rotate(90deg); }

  .info-content {
    margin-top: 1rem;
    font-size: 0.88rem;
    color: var(--text-dim);
    line-height: 1.65;
  }

  .info-content p { margin-bottom: 0.7rem; }
  .info-content strong { color: var(--text); font-weight: 600; }

  .info-content code {
    font-family: 'JetBrains Mono', monospace;
    background: var(--surface3);
    padding: 0.1rem 0.35rem;
    border-radius: 3px;
    font-size: 0.82rem;
    color: var(--accent);
  }

  .note {
    background: #1a2030;
    border-left: 3px solid var(--blue);
    padding: 0.75rem 1rem;
    margin-top: 0.8rem;
    border-radius: 0 8px 8px 0;
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.5;
  }

  .note.warn {
    border-left-color: var(--yellow);
    background: #1f1d14;
  }

  footer {
    text-align: center;
    margin-top: 2.5rem;
    padding: 1rem;
    color: var(--text-dim);
    font-size: 0.75rem;
  }

  footer a { color: var(--accent); text-decoration: none; }
  footer a:hover { text-decoration: underline; }

  @media (max-width: 500px) {
    .input-grid { grid-template-columns: 1fr; }
    body { padding: 1rem; }
    header { flex-direction: column; gap: 0.8rem; }
  }
</style>
</head>
<body>

<div class="container">

  <header>
    <div>
      <h1 data-i18n="title">UnUn Loss <span>Calculator</span></h1>
      <p class="subtitle" data-i18n="subtitle">S21 measurement with L-pad divider on NanoVNA</p>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="btn-pl" onclick="setLang('pl')">PL</button>
    </div>
  </header>

  <!-- SCHEMAT -->
  <div class="diagram-section">
    <h2 data-i18n="diagram_title">Connection diagram</h2>
    <svg viewBox="0 0 680 180" width="100%" style="display:block;">
      <defs>
        <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="#ffe66d"/>
        </marker>
      </defs>
      <rect x="5" y="45" width="90" height="70" rx="6" fill="#1e3a5f" stroke="#5b9bd5" stroke-width="1.5"/>
      <text x="50" y="72" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700">VNA P1</text>
      <text x="50" y="90" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="9" opacity="0.7">50 Î©</text>
      <line x1="95" y1="75" x2="160" y2="75" stroke="#5b9bd5" stroke-width="2"/>
      <rect x="160" y="40" width="110" height="80" rx="6" fill="#3a1e1e" stroke="#ff6b6b" stroke-width="1.5"/>
      <text x="215" y="68" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700">UnUn</text>
      <text x="215" y="85" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono, monospace" font-size="9" opacity="0.7">1 : k</text>
      <text x="215" y="108" text-anchor="middle" fill="#ff6b6b" font-family="JetBrains Mono, monospace" font-size="8" opacity="0.5" data-i18n-svg="svg_dut">â† DUT</text>
      <line x1="270" y1="75" x2="320" y2="75" stroke="#ff6b6b" stroke-width="2"/>
      <rect x="320" y="62" width="80" height="26" rx="4" fill="none" stroke="#4ecdc4" stroke-width="1.5"/>
      <text x="360" y="80" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="10" font-weight="600">Râ‚</text>
      <text x="360" y="55" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="8" data-i18n-svg="svg_series">series</text>
      <line x1="400" y1="75" x2="460" y2="75" stroke="#4ecdc4" stroke-width="2"/>
      <circle cx="460" cy="75" r="3" fill="#4ecdc4"/>
      <line x1="460" y1="78" x2="460" y2="98" stroke="#4ecdc4" stroke-width="1.5"/>
      <rect x="448" y="98" width="24" height="42" rx="4" fill="none" stroke="#4ecdc4" stroke-width="1.5"/>
      <text x="460" y="123" text-anchor="middle" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="9" font-weight="600">Râ‚‚</text>
      <line x1="460" y1="140" x2="460" y2="160" stroke="#6b8e5a" stroke-width="1.5" stroke-dasharray="4,2"/>
      <text x="485" y="125" text-anchor="start" fill="#4ecdc4" font-family="JetBrains Mono, monospace" font-size="8" data-i18n-svg="svg_shunt">shunt</text>
      <line x1="460" y1="75" x2="575" y2="75" stroke="#5b9bd5" stroke-width="2"/>
      <rect x="575" y="45" width="90" height="70" rx="6" fill="#1e3a5f" stroke="#5b9bd5" stroke-width="1.5"/>
      <text x="620" y="72" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700">VNA P2</text>
      <text x="620" y="90" text-anchor="middle" fill="#5b9bd5" font-family="JetBrains Mono, monospace" font-size="9" opacity="0.7">50 Î©</text>
      <line x1="50" y1="115" x2="50" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="215" y1="120" x2="215" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="30" y1="160" x2="650" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <line x1="620" y1="115" x2="620" y2="160" stroke="#6b8e5a" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="340" y="175" text-anchor="middle" fill="#6b8e5a" font-family="JetBrains Mono, monospace" font-size="9">GND</text>
      <line x1="130" y1="30" x2="530" y2="30" stroke="#ffe66d" stroke-width="1" marker-end="url(#arr)" opacity="0.5"/>
      <text x="330" y="25" text-anchor="middle" fill="#ffe66d" font-family="JetBrains Mono, monospace" font-size="8" opacity="0.6" data-i18n-svg="svg_signal">S21 signal â†’</text>
    </svg>
  </div>

  <!-- L-PAD -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--accent)"></span> <span data-i18n="lpad_title">L-pad divider parameters</span></div>
    <div class="input-grid">
      <div class="input-group">
        <label data-i18n="r1_label">Râ‚ (series)</label>
        <div class="input-row">
          <input type="number" id="r1" value="1206.9" step="0.1" oninput="calculate()">
          <span class="unit">Î©</span>
        </div>
      </div>
      <div class="input-group">
        <label data-i18n="r2_label">Râ‚‚ (shunt)</label>
        <div class="input-row">
          <input type="number" id="r2" value="50.034" step="0.001" oninput="calculate()">
          <span class="unit">Î©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- UNUN -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--red)"></span> <span data-i18n="unun_title">UnUn parameters</span></div>
    <div class="input-grid">
      <div class="input-group">
        <label data-i18n="ratio_label">Impedance ratio (k)</label>
        <div class="input-row">
          <input type="number" id="ratio" value="25" step="1" oninput="calculate()">
          <span class="unit">: 1</span>
        </div>
      </div>
      <div class="input-group">
        <label data-i18n="z0_label">Zâ‚€ (VNA impedance)</label>
        <div class="input-row">
          <input type="number" id="z0" value="50" step="1" oninput="calculate()">
          <span class="unit">Î©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- VNA READING -->
  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--yellow)"></span> <span data-i18n="vna_title">NanoVNA reading â€” S21 LogMag from marker</span></div>
    <div class="input-grid">
      <div class="input-group">
        <label data-i18n="s21_label">Measured S21</label>
        <div class="input-row">
          <input type="number" id="s21measured" value="-20.5" step="0.1" oninput="calculate()">
          <span class="unit">dB</span>
        </div>
      </div>
      <div class="input-group">
        <label data-i18n="freq_label">Frequency (informational)</label>
        <div class="input-row">
          <input type="number" id="freq" value="7.1" step="0.1" placeholder="e.g. 7.1">
          <span class="unit">MHz</span>
        </div>
      </div>
    </div>
    <div class="note" style="margin-top:0.8rem" data-i18n-html="vna_note">
      ğŸ’¡ Measure S21 separately at each band frequency. UnUn losses increase with frequency â€” check at 3.5, 7, 14, 21 and 28 MHz.
    </div>
  </div>

  <!-- â•â•â• RESULTS + GAUGE â•â•â• -->
  <div class="results">
    <div class="card-title"><span class="dot" style="background:var(--green)"></span> <span data-i18n="results_title">Results</span></div>

    <div class="gauge-container">
      <div class="gauge-label-row">
        <span class="gauge-title" data-i18n="gauge_title">UnUn transformer loss</span>
        <span class="gauge-value" id="gauge-val">â€” <span class="unit-sm">dB</span></span>
      </div>
      <div class="gauge-track">
        <div class="gauge-fill" id="gauge-fill" style="width:0%; background:var(--green);">
          <div class="gauge-glow" id="gauge-glow"></div>
        </div>
      </div>
      <div class="gauge-ticks">
        <span>0</span><span>0.25</span><span>0.5</span><span>1.0</span><span>1.5</span><span>2.0</span><span>3.0+ dB</span>
      </div>
      <div class="gauge-zones">
        <span class="zone-tag zt-excellent inactive" id="zt-exc" data-i18n="zone_exc">â—‰ Excellent &lt; 0.5 dB</span>
        <span class="zone-tag zt-good inactive" id="zt-good" data-i18n="zone_good">â—‰ OK 0.5â€“1.0 dB</span>
        <span class="zone-tag zt-poor inactive" id="zt-poor" data-i18n="zone_poor">â—‰ Poor &gt; 1.0 dB</span>
      </div>
    </div>

    <div class="result-row">
      <span class="result-label" data-i18n="res_zunun">UnUn output Z (k Ã— Zâ‚€)</span>
      <span class="result-value blue" id="out-zunun">â€”</span>
    </div>
    <div class="result-row">
      <span class="result-label" data-i18n="res_zin">Divider input Z (Râ‚ + Râ‚‚â€–Zâ‚€)</span>
      <span class="result-value accent" id="out-zin">â€”</span>
    </div>
    <div class="result-row">
      <span class="result-label" data-i18n="res_zref">Reflected Z to primary side</span>
      <span class="result-value" id="out-zreflected">â€”</span>
    </div>
    <div class="result-row">
      <span class="result-label" data-i18n="res_divloss">Divider attenuation (theoretical)</span>
      <span class="result-value" id="out-divloss" style="color:var(--yellow)">â€”</span>
    </div>
    <div class="result-row">
      <span class="result-label" data-i18n="res_s21">Measured S21 (full path)</span>
      <span class="result-value" id="out-s21meas">â€”</span>
    </div>

    <div class="formula-display">
      <span class="hl">Râ‚‚â€–Zâ‚€</span> = Râ‚‚Â·Zâ‚€ / (Râ‚‚+Zâ‚€)<br>
      <span class="hl3">S21_div</span> = 10Â·logâ‚â‚€( 4Â·Z_sÂ·(Râ‚‚â€–Zâ‚€)Â² / ((Z_s+Râ‚+Râ‚‚â€–Zâ‚€)Â²Â·Zâ‚€) )<br>
      <span class="hl2" data-i18n="formula_loss">UnUn Loss</span> = <span class="hl3">S21_div</span> âˆ’ S21_measured
    </div>
  </div>

  <!-- â•â•â• INFO: FREQUENCY â•â•â• -->
  <details class="info-section" open>
    <summary>ğŸ“¡ <span data-i18n="info_freq_title">Does frequency matter?</span></summary>
    <div class="info-content" data-i18n-html="info_freq_body">
      <p><strong>Yes, significantly.</strong> UnUn losses change with frequency â€” they typically increase toward higher bands. A single measurement is not enough. You should measure S21 at multiple frequencies (using markers) and compare losses separately for each band.</p>
      <p><strong>Typical behavior:</strong> at 3.5 MHz losses may be 0.2 dB, at 14 MHz â€” 0.5 dB, and at 28 MHz â€” 1+ dB. This depends on core material (mix 43, 31, 61 etc.), number of turns, and construction.</p>
      <p><strong>The resistive divider</strong> itself is broadband and essentially frequency-independent â€” provided you use <strong>non-inductive</strong> resistors (metal film, SMD, or composition).</p>
      <div class="note warn">
        âš  <strong>Do not use wire-wound resistors!</strong> Their parasitic inductance will corrupt measurements above ~10 MHz. Metal film or SMD resistors are fine.
      </div>
    </div>
  </details>

  <!-- â•â•â• INFO: CALIBRATION â•â•â• -->
  <details class="info-section">
    <summary>ğŸ”§ <span data-i18n="info_cal_title">How to calibrate the NanoVNA?</span></summary>
    <div class="info-content" data-i18n-html="info_cal_body">
      <p><strong>Full 2-port calibration (SOLT + THRU)</strong> â€” essential for accurate S21:</p>
      <p><strong>1.</strong> Set frequency range: <code>STIMULUS â†’ START 1 MHz</code>, <code>STOP 30 MHz</code></p>
      <p><strong>2.</strong> Connect cables to both ports â€” the same cables you'll use for the measurement</p>
      <p><strong>3.</strong> Calibrate at cable ends:</p>
      <p>â€¢ Port CH0: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>
      â€¢ Port CH1: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>
      â€¢ Both ports: <code>THRU</code> (connect P1 to P2)</p>
      <p><strong>4.</strong> Save: <code>CAL â†’ SAVE â†’ SAVE 0</code></p>
      <p><strong>5. Verify:</strong> connect THRU and check that S21 reads ~0 dB. Â±0.1 dB is OK.</p>
      <div class="note">
        ğŸ’¡ Calibration is valid for a specific set of cables and frequency range. Change cables â€” recalibrate.
      </div>
      <div class="note warn" style="margin-top:0.5rem">
        âš  Calibrate <strong>without</strong> the UnUn and divider. Calibration establishes the reference plane at the cable ends.
      </div>
    </div>
  </details>

  <!-- â•â•â• INFO: PROCEDURE â•â•â• -->
  <details class="info-section">
    <summary>ğŸ“‹ <span data-i18n="info_proc_title">Step-by-step procedure</span></summary>
    <div class="info-content" data-i18n-html="info_proc_body">
      <p><strong>1.</strong> Calibrate NanoVNA (2-port, 1â€“30 MHz)</p>
      <p><strong>2.</strong> Enable: <code>DISPLAY â†’ TRACE â†’ CH1</code> â†’ <code>FORMAT â†’ LOGMAG</code></p>
      <p><strong>3.</strong> Connect: P1 â†’ UnUn (50 Î© input) â†’ UnUn output â†’ Râ‚ series â†’ junction â†’ P2, with Râ‚‚ from junction to GND</p>
      <p><strong>4.</strong> Set markers: <code>MARKER â†’ SELECT</code> at 3.5, 7, 14, 21, 28 MHz</p>
      <p><strong>5.</strong> Read S21 [dB] from each marker â†’ enter in this calculator</p>
      <p><strong>6.</strong> Calculator subtracts divider attenuation = pure UnUn loss</p>
      <div class="note">
        ğŸ’¡ <strong>Divider verification:</strong> connect the divider alone (no UnUn) P1 â†’ Râ‚ â†’ Râ‚‚ â†’ P2. S21 should match the "Divider attenuation" value from the calculator (Â±0.2 dB).
      </div>
    </div>
  </details>

  <footer>
    SA0KAM Â· <a href="https://github.com/mashu/UnunCalc">GitHub</a>
  </footer>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// i18n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const i18n = {
  en: {
    title: 'UnUn Loss <span>Calculator</span>',
    subtitle: 'S21 measurement with L-pad divider on NanoVNA',
    diagram_title: 'Connection diagram',
    lpad_title: 'L-pad divider parameters',
    r1_label: 'Râ‚ (series)',
    r2_label: 'Râ‚‚ (shunt)',
    unun_title: 'UnUn parameters',
    ratio_label: 'Impedance ratio (k)',
    z0_label: 'Zâ‚€ (VNA impedance)',
    vna_title: 'NanoVNA reading â€” S21 LogMag from marker',
    s21_label: 'Measured S21',
    freq_label: 'Frequency (informational)',
    vna_note: 'ğŸ’¡ Measure S21 separately at each band frequency. UnUn losses increase with frequency â€” check at 3.5, 7, 14, 21 and 28\u00A0MHz.',
    results_title: 'Results',
    gauge_title: 'UnUn transformer loss',
    zone_exc: 'â—‰ Excellent < 0.5 dB',
    zone_good: 'â—‰ OK 0.5â€“1.0 dB',
    zone_poor: 'â—‰ Poor > 1.0 dB',
    res_zunun: 'UnUn output Z (k Ã— Zâ‚€)',
    res_zin: 'Divider input Z (Râ‚ + Râ‚‚â€–Zâ‚€)',
    res_zref: 'Reflected Z to primary side',
    res_divloss: 'Divider attenuation (theoretical)',
    res_s21: 'Measured S21 (full path)',
    formula_loss: 'UnUn Loss',
    gauge_negative: 'dB âš  negative',
    svg_dut: 'â† DUT',
    svg_series: 'series',
    svg_shunt: 'shunt',
    svg_signal: 'S21 signal â†’',
    info_freq_title: 'Does frequency matter?',
    info_freq_body: '<p><strong>Yes, significantly.</strong> UnUn losses change with frequency â€” they typically increase toward higher bands. A single measurement is not enough. You should measure S21 at multiple frequencies (using markers) and compare losses separately for each band.</p><p><strong>Typical behavior:</strong> at 3.5 MHz losses may be 0.2 dB, at 14 MHz â€” 0.5 dB, and at 28 MHz â€” 1+ dB. This depends on core material (mix 43, 31, 61 etc.), number of turns, and construction.</p><p><strong>The resistive divider</strong> itself is broadband and essentially frequency-independent â€” provided you use <strong>non-inductive</strong> resistors (metal film, SMD, or composition).</p><div class="note warn">âš  <strong>Do not use wire-wound resistors!</strong> Their parasitic inductance will corrupt measurements above ~10 MHz. Metal film or SMD resistors are fine.</div>',
    info_cal_title: 'How to calibrate the NanoVNA?',
    info_cal_body: '<p><strong>Full 2-port calibration (SOLT + THRU)</strong> â€” essential for accurate S21:</p><p><strong>1.</strong> Set frequency range: <code>STIMULUS â†’ START 1 MHz</code>, <code>STOP 30 MHz</code></p><p><strong>2.</strong> Connect cables to both ports â€” the same cables you\'ll use for the measurement</p><p><strong>3.</strong> Calibrate at cable ends:</p><p>â€¢ Port CH0: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Port CH1: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Both ports: <code>THRU</code> (connect P1 to P2)</p><p><strong>4.</strong> Save: <code>CAL â†’ SAVE â†’ SAVE 0</code></p><p><strong>5. Verify:</strong> connect THRU and check that S21 reads ~0 dB. Â±0.1 dB is OK.</p><div class="note">ğŸ’¡ Calibration is valid for a specific set of cables and frequency range. Change cables â€” recalibrate.</div><div class="note warn" style="margin-top:0.5rem">âš  Calibrate <strong>without</strong> the UnUn and divider. Calibration establishes the reference plane at the cable ends.</div>',
    info_proc_title: 'Step-by-step procedure',
    info_proc_body: '<p><strong>1.</strong> Calibrate NanoVNA (2-port, 1â€“30 MHz)</p><p><strong>2.</strong> Enable: <code>DISPLAY â†’ TRACE â†’ CH1</code> â†’ <code>FORMAT â†’ LOGMAG</code></p><p><strong>3.</strong> Connect: P1 â†’ UnUn (50 Î© input) â†’ UnUn output â†’ Râ‚ series â†’ junction â†’ P2, with Râ‚‚ from junction to GND</p><p><strong>4.</strong> Set markers: <code>MARKER â†’ SELECT</code> at 3.5, 7, 14, 21, 28 MHz</p><p><strong>5.</strong> Read S21 [dB] from each marker â†’ enter in this calculator</p><p><strong>6.</strong> Calculator subtracts divider attenuation = pure UnUn loss</p><div class="note">ğŸ’¡ <strong>Divider verification:</strong> connect the divider alone (no UnUn) P1 â†’ Râ‚ â†’ Râ‚‚ â†’ P2. S21 should match the "Divider attenuation" value from the calculator (Â±0.2 dB).</div>',
  },
  pl: {
    title: 'Kalkulator strat <span>UnUn</span>',
    subtitle: 'Pomiar S21 z dzielnikiem L-pad na NanoVNA',
    diagram_title: 'Schemat poÅ‚Ä…czenia',
    lpad_title: 'Parametry dzielnika L-pad',
    r1_label: 'Râ‚ (szeregowy)',
    r2_label: 'Râ‚‚ (bocznikowy)',
    unun_title: 'Parametry UnUn',
    ratio_label: 'PrzeÅ‚oÅ¼enie impedancyjne (k)',
    z0_label: 'Zâ‚€ (impedancja VNA)',
    vna_title: 'Odczyt z NanoVNA â€” S21 LogMag z markera',
    s21_label: 'S21 zmierzone',
    freq_label: 'CzÄ™stotliwoÅ›Ä‡ (informacyjnie)',
    vna_note: 'ğŸ’¡ Zmierz S21 osobno na kaÅ¼dej czÄ™stotliwoÅ›ci pasma. Straty UnUn-a rosnÄ… z czÄ™stotliwoÅ›ciÄ… â€” sprawdÅº na 3.5, 7, 14, 21 i 28\u00A0MHz.',
    results_title: 'Wyniki',
    gauge_title: 'Straty transformatora UnUn',
    zone_exc: 'â—‰ DoskonaÅ‚y < 0.5 dB',
    zone_good: 'â—‰ OK 0.5â€“1.0 dB',
    zone_poor: 'â—‰ SÅ‚aby > 1.0 dB',
    res_zunun: 'Z wyjÅ›cia UnUn (k Ã— Zâ‚€)',
    res_zin: 'Z wejÅ›cia dzielnika (Râ‚ + Râ‚‚â€–Zâ‚€)',
    res_zref: 'Z odbita na stronÄ™ pierwotnÄ…',
    res_divloss: 'TÅ‚umienie dzielnika (teoretyczne)',
    res_s21: 'S21 zmierzone (caÅ‚y tor)',
    formula_loss: 'Straty UnUn',
    gauge_negative: 'dB âš  ujemne',
    svg_dut: 'â† mierzymy',
    svg_series: 'szereg.',
    svg_shunt: 'bocznik',
    svg_signal: 'sygnaÅ‚ S21 â†’',
    info_freq_title: 'Czy czÄ™stotliwoÅ›Ä‡ ma znaczenie?',
    info_freq_body: '<p><strong>Tak, i to bardzo.</strong> Straty UnUn-a zmieniajÄ… siÄ™ z czÄ™stotliwoÅ›ciÄ… â€” zwykle rosnÄ… w gÃ³rÄ™ pasma. Dlatego nie wystarczy jeden pomiar. PowinieneÅ› zmierzyÄ‡ S21 na kilku czÄ™stotliwoÅ›ciach (markerami) i porÃ³wnaÄ‡ straty osobno dla kaÅ¼dego pasma.</p><p><strong>Typowe zachowanie:</strong> na 3.5 MHz straty mogÄ… byÄ‡ 0.2 dB, na 14 MHz â€” 0.5 dB, a na 28 MHz â€” juÅ¼ 1+ dB. ZaleÅ¼y od materiaÅ‚u rdzenia (mix 43, 31, 61 itd.), liczby zwojÃ³w i konstrukcji.</p><p><strong>Dzielnik rezystancyjny</strong> jest szerokopasmowy i prawie nie zmienia siÄ™ z czÄ™stotliwoÅ›ciÄ… â€” pod warunkiem, Å¼e uÅ¼yjesz rezystorÃ³w <strong>nieindukcyjnych</strong> (metal film, SMD, kompozytowych).</p><div class="note warn">âš  <strong>Nie uÅ¼ywaj rezystorÃ³w drutowych!</strong> Ich indukcyjnoÅ›Ä‡ pasoÅ¼ytnicza zafaÅ‚szuje pomiar powyÅ¼ej ~10 MHz. Rezystory metalowarstwowe (metal film) lub SMD sÄ… OK.</div>',
    info_cal_title: 'Jak skalibrowaÄ‡ NanoVNA?',
    info_cal_body: '<p><strong>Kalibracja 2-portowa (SOLT + THRU)</strong> â€” kluczowa dla wiarygodnego S21:</p><p><strong>1.</strong> Ustaw zakres: <code>STIMULUS â†’ START 1 MHz</code>, <code>STOP 30 MHz</code></p><p><strong>2.</strong> PodÅ‚Ä…cz kable do obu portÃ³w â€” te same, ktÃ³re uÅ¼yjesz w pomiarze</p><p><strong>3.</strong> Kalibruj na koÅ„cÃ³wkach kabli:</p><p>â€¢ Port CH0: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Port CH1: <code>OPEN</code> â†’ <code>SHORT</code> â†’ <code>LOAD</code> (50 Î©)<br>â€¢ Razem: <code>THRU</code> (poÅ‚Ä…cz P1 z P2)</p><p><strong>4.</strong> <code>CAL â†’ SAVE â†’ SAVE 0</code></p><p><strong>5. Weryfikacja:</strong> podÅ‚Ä…cz THRU i sprawdÅº Å¼e S21 â‰ˆ 0 dB (Â±0.1 dB = OK)</p><div class="note">ğŸ’¡ Kalibracja jest waÅ¼na dla konkretnych kabli i zakresu czÄ™stotliwoÅ›ci. Zmienisz kable â€” kalibruj od nowa.</div><div class="note warn" style="margin-top:0.5rem">âš  Kalibruj <strong>bez</strong> UnUn-a i bez dzielnika. Kalibracja ustala punkt odniesienia na koÅ„cÃ³wkach kabli.</div>',
    info_proc_title: 'Procedura krok po kroku',
    info_proc_body: '<p><strong>1.</strong> Skalibruj NanoVNA (2-port, 1â€“30 MHz)</p><p><strong>2.</strong> WÅ‚Ä…cz: <code>DISPLAY â†’ TRACE â†’ CH1</code> â†’ <code>FORMAT â†’ LOGMAG</code></p><p><strong>3.</strong> PodÅ‚Ä…cz: P1 â†’ UnUn (50 Î©) â†’ wyjÅ›cie UnUn â†’ Râ‚ szereg. â†’ junction â†’ P2, Râ‚‚ od junction do GND</p><p><strong>4.</strong> Markery: <code>MARKER â†’ SELECT</code> na 3.5, 7, 14, 21, 28 MHz</p><p><strong>5.</strong> Odczytaj S21 [dB] z kaÅ¼dego markera â†’ wpisz tu</p><p><strong>6.</strong> Kalkulator odejmie tÅ‚umienie dzielnika = czyste straty UnUn-a</p><div class="note">ğŸ’¡ <strong>Weryfikacja dzielnika:</strong> podÅ‚Ä…cz sam dzielnik (bez UnUn-a) P1 â†’ Râ‚ â†’ Râ‚‚ â†’ P2. S21 powinno zgadzaÄ‡ siÄ™ z wartoÅ›ciÄ… â€TÅ‚umienie dzielnika" z kalkulatora (Â±0.2 dB).</div>',
  }
};

let currentLang = 'en';

function setLang(lang) {
  currentLang = lang;
  document.getElementById('btn-en').classList.toggle('active', lang === 'en');
  document.getElementById('btn-pl').classList.toggle('active', lang === 'pl');
  document.documentElement.lang = lang;

  // Text nodes
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (i18n[lang][key] !== undefined) {
      if (el.tagName === 'H1' || key === 'title') {
        el.innerHTML = i18n[lang][key];
      } else {
        el.textContent = i18n[lang][key];
      }
    }
  });

  // HTML content blocks
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    const key = el.getAttribute('data-i18n-html');
    if (i18n[lang][key] !== undefined) {
      el.innerHTML = i18n[lang][key];
    }
  });

  // SVG text elements
  document.querySelectorAll('[data-i18n-svg]').forEach(el => {
    const key = el.getAttribute('data-i18n-svg');
    if (i18n[lang][key] !== undefined) {
      el.textContent = i18n[lang][key];
    }
  });

  calculate();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getGaugeColor(loss) {
  if (loss < 0) return { css: '#a78bfa', r: 167, g: 139, b: 250 };
  if (loss <= 0.5) return { css: '#6bcf7f', r: 107, g: 207, b: 127 };
  if (loss <= 1.0) {
    const t = (loss - 0.5) / 0.5;
    return {
      css: null,
      r: Math.round(107 + (255 - 107) * t),
      g: Math.round(207 + (230 - 207) * t),
      b: Math.round(127 + (109 - 127) * t)
    };
  }
  if (loss <= 2.0) {
    const t = (loss - 1.0) / 1.0;
    return {
      css: null,
      r: Math.round(255 + (255 - 255) * t),
      g: Math.round(230 + (107 - 230) * t),
      b: Math.round(109 + (107 - 109) * t)
    };
  }
  return { css: '#ff6b6b', r: 255, g: 107, b: 107 };
}

function colorStr(c) {
  return c.css || `rgb(${c.r},${c.g},${c.b})`;
}

function calculate() {
  const R1 = parseFloat(document.getElementById('r1').value) || 0;
  const R2 = parseFloat(document.getElementById('r2').value) || 0;
  const k  = parseFloat(document.getElementById('ratio').value) || 25;
  const Z0 = parseFloat(document.getElementById('z0').value) || 50;
  const S21meas = parseFloat(document.getElementById('s21measured').value) || 0;

  const Zunun = k * Z0;
  const R2par = (R2 * Z0) / (R2 + Z0);
  const Zin_div = R1 + R2par;
  const Zreflected = Zin_div / k;
  const Zs = Zunun;
  const Ztotal = Zs + R1 + R2par;
  const S21sq = (4 * Zs * R2par * R2par) / (Ztotal * Ztotal * Z0);
  const S21div_dB = 10 * Math.log10(S21sq);
  const loss = S21div_dB - S21meas;

  // Text results
  document.getElementById('out-zunun').textContent = Zunun.toFixed(1) + ' Î©';
  document.getElementById('out-zin').textContent = Zin_div.toFixed(1) + ' Î©';
  document.getElementById('out-divloss').textContent = S21div_dB.toFixed(2) + ' dB';
  document.getElementById('out-s21meas').textContent = S21meas.toFixed(1) + ' dB';

  // Reflected Z
  const zrefEl = document.getElementById('out-zreflected');
  const mismatch = Math.abs(Zreflected - Z0) / Z0 * 100;
  zrefEl.textContent = Zreflected.toFixed(1) + ' Î©';
  if (mismatch < 5) {
    zrefEl.style.color = 'var(--green)';
    zrefEl.textContent += ' âœ“';
  } else if (mismatch < 15) {
    zrefEl.style.color = 'var(--yellow)';
    zrefEl.textContent += ' ~';
  } else {
    zrefEl.style.color = 'var(--red)';
    zrefEl.textContent += ' âœ—';
  }

  // Gauge
  const absLoss = Math.max(0, loss);
  const maxGauge = 3.0;
  const pct = Math.min(absLoss / maxGauge * 100, 100);
  const color = getGaugeColor(loss);
  const colorCSS = colorStr(color);

  const fill = document.getElementById('gauge-fill');
  const glow = document.getElementById('gauge-glow');
  fill.style.width = pct + '%';
  fill.style.backgroundColor = colorCSS;
  fill.style.boxShadow = `0 0 16px ${colorCSS}44, 0 0 4px ${colorCSS}88`;
  glow.style.backgroundColor = colorCSS;

  const gaugeVal = document.getElementById('gauge-val');
  const t = i18n[currentLang];
  if (loss < 0) {
    gaugeVal.innerHTML = Math.abs(loss).toFixed(2) + ' <span class="unit-sm">' + t.gauge_negative + '</span>';
  } else {
    gaugeVal.innerHTML = loss.toFixed(2) + ' <span class="unit-sm">dB</span>';
  }
  gaugeVal.style.color = colorCSS;

  // Zone tags
  const zones = [
    { el: document.getElementById('zt-exc'),  active: loss >= 0 && loss <= 0.5 },
    { el: document.getElementById('zt-good'), active: loss > 0.5 && loss <= 1.0 },
    { el: document.getElementById('zt-poor'), active: loss > 1.0 },
  ];

  zones.forEach(z => {
    z.el.className = z.el.className.replace(/\s*(active|inactive)/g, '');
    z.el.classList.add((loss < 0 ? false : z.active) ? 'active' : 'inactive');
  });
}

// Init
calculate();
</script>

<noscript>
  <p style="color:#ff6b6b;text-align:center;padding:2rem;">This calculator requires JavaScript. / Ten kalkulator wymaga JavaScript.</p>
</noscript>

</body>
</html>
